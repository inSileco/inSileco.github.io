<!DOCTYPE html>
<html lang="en-us">

    <head>

        <title>Efficiency of spatial intersects in R</title>

        <style>

    html body {
        font-family: Lato, sans-serif;
        background-color: white;
    }

    :root {
        --accent: #3fb3b2;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/css/main.css">



  <link rel="stylesheet" href="/css/academicons.min.css">

  <link rel="stylesheet" href="/css/font-awesome.min.css">

  <link rel="stylesheet" href="/css/insileco.css">

  <link rel="stylesheet" href="/css/jquery.tocify.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">

  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">



<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">


 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
 


    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

    

    <script>hljs.initHighlightingOnLoad();</script>





  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



  <script src="/js/jquery-1.8.3.min.js"></script>

  <script src="/js/jquery-ui-1.9.1.custom.min.js"></script>

  <script src="/js/jquery.tocify.min.js"></script>


        <meta charset="utf-8">

        <meta name="viewport" content="width=device-width, initial-scale=1">

        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109508556-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());
          gtag('config', 'UA-109508556-1');
        </script>
        


    </head>

    <body>

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Efficiency of spatial intersects in R</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/about/">About</a></li>
                            
                                <li><a href="https://insilecoinc.github.io/">Consulting</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/software/">Software</a></li>
                            
                                <li><a href="/wiki/">Wiki</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/inSileco/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/inSileco/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://insileco.github.io/index.xml"><i class="fa fa-rss"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<img class="full-width" width="100%" src="/img/banner4.png"></img>


<div>

  <div class="col-md-3">
      <div class="hidden-sm hidden-xs">
        <div class="sticky-top">
          <div id="toc"></div>

        </div>
    </div>
  </div>


  <div class="col-md-8">

    <h1><a href="/2017/09/12/efficiency-of-spatial-intersects-in-r/">Efficiency of spatial intersects in R</a></h1>

    <h4>September 12, 2017</h4>

    <p>
      <i class="fa fa-tags" aria-hidden="true"></i> &nbsp;  <a href="/tags/r"><kbd class="item-tag">R</kbd></a>  <a href="/tags/spatial"><kbd class="item-tag">spatial</kbd></a>  <a href="/tags/intersection"><kbd class="item-tag">intersection</kbd></a> 
      <br>
      
       <img src = "/img/Rlogo.svg" title="List of R packages required for this post." width="7%"></img> &nbsp;  <a href="/rpkgs/sf"><kbd class="item-tag2">sf</kbd></a>  <a href="/rpkgs/sp"><kbd class="item-tag2">sp</kbd></a>  <a href="/rpkgs/rgeos"><kbd class="item-tag2">rgeos</kbd></a> 
      
    </p>

    
      <p style = "font-size: 1.6em;"> <i class="fa fa-pencil" aria-hidden="true" title="Author(s)"></i>
       
        <a href="/about/">David Beauchesne</a> &nbsp;
       
        <a href="/about/">RÃ©mi Daigle</a> &nbsp;
      
     <a href="#"></a></p>
    

    
      <p> <i class="fa fa-check-square" aria-hidden="true", title="Reviewer(s)"></i>
       
      <a href="/about/">Kevin Cazelles</a> &nbsp;
      
      <a href="#"></a></p>
    

    <p>
    
    
    
      <img src='https://img.shields.io/static/v1?style=flat&amp;label=reading%20time&amp;message=10min&amp;color=3fb3b2&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA/1BMVEU/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7L////QnMRFAAAAVHRSTlMAAyRgm8Pa5C&#43;GyOPo5xV40unq3y2szJpqSjw3wcVtIwTikCLebwkBeQUQHTB30ZgHAojvroftrQjNS4nsBmfcKbbLbBMXdOvmsUgynn8LWMBxIGRFHj3/AAAAAWJLR0RU5AOIpQAAAAlwSFlzAAAN5QAADeUB5upprwAAAAd0SU1FB&#43;QEBQceG9g0RXAAAAFvSURBVDjLhVPXdoJAEF0BQdwZZMHeKIolMUbTJb2aXv//X4IFZD16uC8wu3fKztwhJERKEKW0rChyWhKFFFlHKqNmKQAGAKBZNbNG0XI6AzCAmiYNPsD0nBa/zxcCPyyWypVqtVIuFWdWIb&#43;6r9UZQqNp2QvTtpoNQFavRf7BveO24iFbrhMwljG0AsO21&#43;GL6nhtZIV5Hd0eouP1F&#43;c7u1p38df3HMTezBjoAG7ovzfcH4UxXAB9QMhYZdCwwsgHh0dRLqsBTB0TIQvYjFIfn5yeRUYTISsQkcJE2EwQJkBFIoFRsjcT7JIBEkkDlMlmAikDpImM1N9G8CnKREGzyhFiHauaqKwRzi8m/iVP4FNcmca1e9ONp&#43;CLHPm3aNzdP8SK5J9JyOPTcPr88jqKnsk3KsD47d2Ztj8uw0bxrZ7j8&#43;sbf6JW88Na4vdPi4bFjzsumeW4ecGssBJMouSSRZss&#43;&#43;TFSV695OUlW9f/HyniMFbfN&#43;2lAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTA0LTA1VDExOjMwOjUyLTA0OjAwwJKD8wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wNC0wNVQxMTozMDoyNy0wNDowMOkyHfEAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC'>
    
    
     &nbsp;
    
    
      <a href = "https://creativecommons.org/licenses/by/4.0/">
      <img src="https://img.shields.io/static/v1?style=flat&label=license&message=CC-BY-4.0&color=f76f2b&logo=creative-commons">
      </a>
     &nbsp;
    
    
      <a href = "https://github.com/inSileco/inSileco.github.io/wiki/Posts#archiving-a-posts">
      <img src="https://img.shields.io/static/v1?style=flat&label=archived&message=2022-04-23&logo=internet-archive&color=6d4f5b">
      <a>
     &nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;
    <a href="http://twitter.com/share?url=https%3a%2f%2finsileco.github.io%2f2017%2f09%2f12%2fefficiency-of-spatial-intersects-in-r%2f&text=R%20spatial%20intersects%20efficiency" target="_blank">
      <img src='https://img.shields.io/twitter/url?style=social&url=https%3a%2f%2finsileco.github.io%2f2017%2f09%2f12%2fefficiency-of-spatial-intersects-in-r%2f?link=http://left&link=http://right}'>
    </a>
  </p>


    <br>

    <div class="text-justify">

      <script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<h2 id="intersects--r">Intersects &amp; R</h2>
<p>We are increasingly performing spatial analyses in R. The replicability and the
efficiency of programming languages is much more appealing than using pieces of
user friendly software like <a href="https://www.arcgis.com/features/index.html">ArcGIS</a>,
even though you can still code your way through analyses when using them
(latter versions of <a href="http://qgis.org/fr/site/">QGIS</a> do a fantastic
job in that regard!). The performance of tools available for spatial analyses in
R is however not completely certain.</p>
<p>In this post, we compare four different methods to perform spatial intersects
between objects in R, from three different packages:</p>
<ol>
<li><code>raster::intersect</code></li>
<li><code>rgeos::gIntersects</code></li>
<li><code>rgeos::gIntersection</code></li>
<li><code>sf::st_intersects</code></li>
<li><code>sf::st_intersection</code></li>
</ol>
<p>More specifically, we test how these methods fare when performing binary
(TRUE/FALSE) and zonal or aerial intersects. Keep in mind, not all methods
can be used for both binary and zonal intersects:</p>
<br/>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Function </th>
   <th style="text-align:left;"> Binary </th>
   <th style="text-align:left;"> Zonal </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> raster::intersect </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:left;"> X </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rgeos::gIntersects </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rgeos::gIntersection </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:left;"> X </td>
  </tr>
  <tr>
   <td style="text-align:left;"> sf::st_intersects </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> sf::st_intersection </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:left;"> X </td>
  </tr>
</tbody>
</table>
<br/>
<p>Obviously, if you mean to perform binary intersects only, the binary functions
make more sense as they are built to include less calculations. We nonetheless
compare all the functions together for the sake of comparison in this post.</p>
<br/>
<h2 id="initiate-r">Initiate R</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># R version</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sessionInfo</span>()[[1L]]<span style="color:#f92672">$</span>version.string
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#34;R version 4.2.0 (2022-04-22)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#--</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rm</span>(list<span style="color:#f92672">=</span><span style="color:#a6e22e">ls</span>())
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(sf)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(rgdal)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(sp)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(raster)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(rgeos)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(magrittr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(knitr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(kableExtra)
</span></span><span style="display:flex;"><span><span style="color:#75715e">##--</span>
</span></span><span style="display:flex;"><span>opts_chunk<span style="color:#f92672">$</span><span style="color:#a6e22e">set</span>(fig.align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">##--</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Empty plot function</span>
</span></span><span style="display:flex;"><span>eplot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, xmin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>(x <span style="color:#f92672">=</span> x,y <span style="color:#f92672">=</span> y,bty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n&#34;</span>,ann <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,xaxt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n&#34;</span>,yaxt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n&#34;</span>,type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n&#34;</span>,bg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;grey&#39;</span>,ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(ymin,ymax),xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(xmin,xmax))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Version of packages that have been used to build this post and are herein discussed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">packageVersion</span>(<span style="color:#e6db74">&#34;raster&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">packageVersion</span>(<span style="color:#e6db74">&#34;rgeos&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">packageVersion</span>(<span style="color:#e6db74">&#34;sf&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#39;3.5.15&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#39;0.5.9&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#39;1.0.7&#39;</span>
</span></span></code></pre></div><br/>
<h2 id="generate-spatial-objects-for-testing">Generate spatial objects for testing</h2>
<p>We start be generating random spatial object in space. For the record,
the area selected is within the St. Lawrence estuary in eastern Canada
(see <a href="https://insileco.github.io/2017/06/19/online-ecology---individual-species-description/">online ecology series</a>),
although the actual location really does not matter for this post!</p>
<br/>
<h2 id="grid">Grid</h2>
<p>We use a regular grid to intersect vectorized data, <em>i.e.</em> points and polygons
for this post. This simulate the use of a grid used to extract environmental
data (biotic and/or abiotic) from multiple sources to characterize a study area.</p>
<br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Projection in lambers</span>
</span></span><span style="display:flex;"><span>projSpat <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;+proj=lcc +lat_1=46 +lat_2=60 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bounding box</span>
</span></span><span style="display:flex;"><span>latmax <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">625000</span>
</span></span><span style="display:flex;"><span>latmin <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">585000</span>
</span></span><span style="display:flex;"><span>lonmax <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">150000</span>
</span></span><span style="display:flex;"><span>lonmin <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">100000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a spatial bounding box for the area of interest using the &#39;sp&#39; package:</span>
</span></span><span style="display:flex;"><span>bb <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(lonmin,lonmax,lonmax,lonmin,lonmin),
</span></span><span style="display:flex;"><span>                   <span style="color:#a6e22e">c</span>(latmin,latmin,latmax,latmax,latmin)) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Polygon</span>() <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">list</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Polygons</span>(ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ID1&#39;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">list</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SpatialPolygons</span>(proj4string <span style="color:#f92672">=</span> <span style="color:#a6e22e">CRS</span>(projSpat))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create spatial grid that will be used for intersects</span>
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000000</span> <span style="color:#75715e"># Surface of cells in m^2 (area in km^2 * 1000000)</span>
</span></span><span style="display:flex;"><span>cellsize <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sqrt</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>A)<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span><span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>) <span style="color:#75715e"># value of the small diagonal</span>
</span></span><span style="display:flex;"><span>grid <span style="color:#f92672">&lt;-</span> sp<span style="color:#f92672">::</span><span style="color:#a6e22e">spsample</span>(bb,type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hexagonal&#34;</span>,cellsize<span style="color:#f92672">=</span>cellsize, offset<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span> <span style="color:#75715e"># Points for a hexagonal grid</span>
</span></span><span style="display:flex;"><span>        sp<span style="color:#f92672">::</span><span style="color:#a6e22e">HexPoints2SpatialPolygons</span>() <span style="color:#75715e"># creating polygons</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We now have a grid of polygons to work with!</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(grid)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(bb, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;blue&#39;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/grid-1.png" width="672" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We need this grid in `sp` and `sf` usable formats</span>
</span></span><span style="display:flex;"><span>gridSP <span style="color:#f92672">&lt;-</span> grid
</span></span><span style="display:flex;"><span>gridSF <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(grid)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">class</span>(gridSP)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#34;SpatialPolygons&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; attr(,&#34;package&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#34;sp&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">class</span>(gridSF)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#34;sf&#34;         &#34;data.frame&#34;</span>
</span></span></code></pre></div><br/>
<h2 id="points-and-polygons">Points and Polygons</h2>
<p>Now we generate random points within the bounding box to test the intersects.
This is done for <code>1, 10, 50, 100, 250, 500, 1000, 10000</code> points. Then, to get
all data required to perform the tests, we also need to create polygons from
the point data.</p>
<br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Number of samples</span>
</span></span><span style="display:flex;"><span>samp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">500</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>nSamp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(samp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Names of points samples</span>
</span></span><span style="display:flex;"><span>sampNames <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#39;Pt&#39;</span>,samp)
</span></span><span style="display:flex;"><span>sampNames
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] &#34;Pt1&#34;     &#34;Pt10&#34;    &#34;Pt50&#34;    &#34;Pt100&#34;   &#34;Pt250&#34;   &#34;Pt500&#34;   &#34;Pt1000&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [8] &#34;Pt10000&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Random points for all samples</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assign</span>(x <span style="color:#f92672">=</span> sampNames[i],
</span></span><span style="display:flex;"><span>           value <span style="color:#f92672">=</span> <span style="color:#a6e22e">data.frame</span>(lon <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(n <span style="color:#f92672">=</span> samp[i], min <span style="color:#f92672">=</span> lonmin, max <span style="color:#f92672">=</span> lonmax),
</span></span><span style="display:flex;"><span>                              lat <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(n <span style="color:#f92672">=</span> samp[i], min <span style="color:#f92672">=</span> latmin, max <span style="color:#f92672">=</span> latmax)))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We now have nSamp new objects with randomly generated coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ls</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [1] &#34;A&#34;         &#34;bb&#34;        &#34;cellsize&#34;  &#34;eplot&#34;     &#34;grid&#34;      &#34;gridSF&#34;   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [7] &#34;gridSP&#34;    &#34;i&#34;         &#34;latmax&#34;    &#34;latmin&#34;    &#34;lonmax&#34;    &#34;lonmin&#34;   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [13] &#34;nSamp&#34;     &#34;projSpat&#34;  &#34;Pt1&#34;       &#34;Pt10&#34;      &#34;Pt100&#34;     &#34;Pt1000&#34;   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [19] &#34;Pt10000&#34;   &#34;Pt250&#34;     &#34;Pt50&#34;      &#34;Pt500&#34;     &#34;res1&#34;      &#34;res2&#34;     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [25] &#34;samp&#34;      &#34;sampNames&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Let&#39;s now create spatial objects with those coordinates for use with the `sp` package</span>
</span></span><span style="display:flex;"><span>sampNamesSP <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(sampNames, <span style="color:#e6db74">&#39;SP&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assign</span>(
</span></span><span style="display:flex;"><span>      x <span style="color:#f92672">=</span> sampNamesSP[i],
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpatialPoints</span>(coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">get</span>(sampNames[i]), proj4string<span style="color:#f92672">=</span><span style="color:#a6e22e">CRS</span>(projSpat))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize them</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mfrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>(bb, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">points</span>(<span style="color:#a6e22e">get</span>(sampNamesSP[i]), cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;transparent&#39;</span>, bg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#1e6b7955&#39;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/randomData-1.png" width="672" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Now we generate polygons from the point data using the `rgeos::gBuffer`,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># see `sf::st_buffer` is the equivalent for the `sf` package</span>
</span></span><span style="display:flex;"><span>sampNamesPoly <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#39;Poly&#39;</span>,samp)
</span></span><span style="display:flex;"><span>sampNamesSPPoly <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(sampNamesPoly, <span style="color:#e6db74">&#39;SP&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assign</span>(x <span style="color:#f92672">=</span> sampNamesSPPoly[i],
</span></span><span style="display:flex;"><span>           value <span style="color:#f92672">=</span> rgeos<span style="color:#f92672">::</span><span style="color:#a6e22e">gBuffer</span>(<span style="color:#a6e22e">get</span>(sampNamesSP[i]), byid <span style="color:#f92672">=</span> T, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize them</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mfrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>(bb, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">get</span>(sampNamesSPPoly[i]), border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;transparent&#39;</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#1e6b7955&#39;</span>, add <span style="color:#f92672">=</span> T)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/randomData2-1.png" width="672" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Transform points and polygons for use with the `sf` package</span>
</span></span><span style="display:flex;"><span>sampNamesSF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(sampNames, <span style="color:#e6db74">&#39;SF&#39;</span>) <span style="color:#75715e"># for points</span>
</span></span><span style="display:flex;"><span>sampNamesSFPoly <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(sampNamesPoly, <span style="color:#e6db74">&#39;SF&#39;</span>) <span style="color:#75715e"># for polygons</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assign</span>(x <span style="color:#f92672">=</span> sampNamesSF[i],
</span></span><span style="display:flex;"><span>           sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(<span style="color:#a6e22e">get</span>(sampNamesSP[i]))) <span style="color:#75715e"># points</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assign</span>(x <span style="color:#f92672">=</span> sampNamesSFPoly[i],
</span></span><span style="display:flex;"><span>           sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(<span style="color:#a6e22e">get</span>(sampNamesSPPoly[i]))) <span style="color:#75715e"># polygons</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><br/>
<h2 id="benchmarking">Benchmarking</h2>
<p>Now that the data is ready for use, we can perform the tests! But first, let&rsquo;s
take a quick look at the type of results that are returned by each function.</p>
<br/>
<h3 id="points-intersections">Points intersections</h3>
<p>First, we will test the intersects only with the points.</p>
<br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(n <span style="color:#f92672">=</span> samp,
</span></span><span style="display:flex;"><span>                   raster_intersect <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   rgeos_gIntersects <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   rgeos_gIntersection <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   sf_st_intersects <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   sf_st_intersection <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    res1<span style="color:#f92672">$</span>raster_intersect[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(raster<span style="color:#f92672">::</span><span style="color:#a6e22e">intersect</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSP[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res1<span style="color:#f92672">$</span>rgeos_gIntersects[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(rgeos<span style="color:#f92672">::</span><span style="color:#a6e22e">gIntersects</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSP[i]), byid <span style="color:#f92672">=</span> T))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res1<span style="color:#f92672">$</span>rgeos_gIntersection[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(rgeos<span style="color:#f92672">::</span><span style="color:#a6e22e">gIntersection</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSP[i]), byid <span style="color:#f92672">=</span> T))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res1<span style="color:#f92672">$</span>sf_st_intersects[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersects</span>(gridSF, <span style="color:#a6e22e">get</span>(sampNamesSF[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res1<span style="color:#f92672">$</span>sf_st_intersection[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersection</span>(gridSF, <span style="color:#a6e22e">get</span>(sampNamesSF[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Visualize results table</span>
</span></span><span style="display:flex;"><span>knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>(res1, <span style="color:#e6db74">&#34;html&#34;</span>, digits <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">kable_styling</span>(full_width <span style="color:#f92672">=</span> F)
</span></span></code></pre></div><table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> n </th>
   <th style="text-align:right;"> raster_intersect </th>
   <th style="text-align:right;"> rgeos_gIntersects </th>
   <th style="text-align:right;"> rgeos_gIntersection </th>
   <th style="text-align:right;"> sf_st_intersects </th>
   <th style="text-align:right;"> sf_st_intersection </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.03 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.03 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 250 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.03 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 500 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1000 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.65 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.05 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10000 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 8.05 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.24 </td>
  </tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize results</span>
</span></span><span style="display:flex;"><span>cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#3fb3b2&#34;</span>, <span style="color:#e6db74">&#34;#484f42&#34;</span>, <span style="color:#e6db74">&#34;#ffdd55&#34;</span>, <span style="color:#e6db74">&#34;#c7254e&#34;</span>, <span style="color:#e6db74">&#34;#1b95e0&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>), ncol <span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>), widths <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>), heights <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>, las<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(res1<span style="color:#f92672">$</span>raster_intersect <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[1], ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">max</span>(res1[,<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>])), xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Number of points&#39;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>rgeos_gIntersects <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[2])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>rgeos_gIntersection <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[3])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>sf_st_intersects <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[4])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>sf_st_intersection <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[5])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Legend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>, las <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eplot</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">legend</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;center&#39;</span>, legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">colnames</span>(res1)[<span style="color:#ae81ff">-1</span>]), bty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;n&#39;</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, col <span style="color:#f92672">=</span> cols, seg.len <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>, title <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(<span style="color:#a6e22e">bold</span>(<span style="color:#e6db74">&#39;Fonctions&#39;</span>)))
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/ptIntersect2-1.png" width="672" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize results without gIntersection</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>), ncol <span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>), widths <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>), heights <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>, las <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(res1<span style="color:#f92672">$</span>raster_intersect <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[1], ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">max</span>(res1[,<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>)])), xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Number of points&#39;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>rgeos_gIntersects <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[2])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>sf_st_intersects <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[4])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res1<span style="color:#f92672">$</span>sf_st_intersection <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[5])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Legend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eplot</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">legend</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;center&#39;</span>, legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">colnames</span>(res1)[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">4</span>)]), bty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;n&#39;</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, col <span style="color:#f92672">=</span> cols[<span style="color:#ae81ff">-3</span>], seg.len <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>, title <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(<span style="color:#a6e22e">bold</span>(<span style="color:#e6db74">&#39;Fonctions&#39;</span>)))
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/ptIntersect2-2.png" width="672" style="display: block; margin: auto;" />
<br/>
<p>In this analysis <code>rgeos::gIntersection</code> is clearly much less efficient than the
alternative options. Using <code>raster::intersect</code>, <code>rgeos::gIntersects</code>,
<code>sf::st_intersects</code> or <code>sf::st_intersection</code> significantly decreases calculation
time, with <code>sf::st_intersects</code> proving to be the most efficient option.</p>
<br/>
<h3 id="polygons-intersections">Polygons intersections</h3>
<p>Now let&rsquo;s take a look at intersects using polygons only.</p>
<br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(n <span style="color:#f92672">=</span> samp,
</span></span><span style="display:flex;"><span>                   raster_intersect <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   rgeos_gIntersects <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   rgeos_gIntersection <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   sf_st_intersects <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp),
</span></span><span style="display:flex;"><span>                   sf_st_intersection <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(nSamp))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nSamp) {
</span></span><span style="display:flex;"><span>    res2<span style="color:#f92672">$</span>raster_intersect[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(raster<span style="color:#f92672">::</span><span style="color:#a6e22e">intersect</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSPPoly[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res2<span style="color:#f92672">$</span>rgeos_gIntersects[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(rgeos<span style="color:#f92672">::</span><span style="color:#a6e22e">gIntersects</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSP[i]), byid <span style="color:#f92672">=</span> T))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res2<span style="color:#f92672">$</span>rgeos_gIntersection[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(rgeos<span style="color:#f92672">::</span><span style="color:#a6e22e">gIntersection</span>(gridSP, <span style="color:#a6e22e">get</span>(sampNamesSPPoly[i]), byid <span style="color:#f92672">=</span> T))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res2<span style="color:#f92672">$</span>sf_st_intersects[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersects</span>(gridSF, <span style="color:#a6e22e">get</span>(sampNamesSFPoly[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>    res2<span style="color:#f92672">$</span>sf_st_intersection[i] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.time</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersection</span>(gridSF, <span style="color:#a6e22e">get</span>(sampNamesSFPoly[i])))[<span style="color:#e6db74">&#39;elapsed&#39;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Visualize results table</span>
</span></span><span style="display:flex;"><span>knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>(res2, <span style="color:#e6db74">&#34;html&#34;</span>, digits <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">kable_styling</span>(full_width <span style="color:#f92672">=</span> F)
</span></span></code></pre></div><table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> n </th>
   <th style="text-align:right;"> raster_intersect </th>
   <th style="text-align:right;"> rgeos_gIntersects </th>
   <th style="text-align:right;"> rgeos_gIntersection </th>
   <th style="text-align:right;"> sf_st_intersects </th>
   <th style="text-align:right;"> sf_st_intersection </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.03 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.07 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 250 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.14 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 500 </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.22 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1000 </td>
   <td style="text-align:right;"> 1.43 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 1.20 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.36 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10000 </td>
   <td style="text-align:right;"> 14.58 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 14.43 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 3.69 </td>
  </tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize results</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>), ncol <span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>), widths <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>), heights <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), las <span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(res2<span style="color:#f92672">$</span>raster_intersect <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[1], ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">max</span>(res2[,<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>])), xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Number of polygons&#39;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>rgeos_gIntersects <span style="color:#f92672">~</span> res1<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[2])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>rgeos_gIntersection <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[3])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>sf_st_intersects <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[4])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>sf_st_intersection <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[5])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Legend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eplot</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">legend</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;center&#39;</span>, legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">colnames</span>(res2)[<span style="color:#ae81ff">-1</span>]), bty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;n&#39;</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, col <span style="color:#f92672">=</span> cols, seg.len <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>, title <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(<span style="color:#a6e22e">bold</span>(<span style="color:#e6db74">&#39;Fonctions&#39;</span>)))
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/polyIntersect2-1.png" width="672" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Visualize results without gIntersection</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>), ncol <span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>), widths <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>), heights <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>, las <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(res2<span style="color:#f92672">$</span>rgeos_gIntersects <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[2], ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">max</span>(res2[,<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>)])), xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Number of points&#39;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Time (s)&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>sf_st_intersects <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[4])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lines</span>(res2<span style="color:#f92672">$</span>sf_st_intersection <span style="color:#f92672">~</span> res2<span style="color:#f92672">$</span>n, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, col <span style="color:#f92672">=</span> cols[5])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Legend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">par</span>(mar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>), family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;serif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eplot</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">legend</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;center&#39;</span>, legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">colnames</span>(res1)[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>)]), bty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;n&#39;</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, col <span style="color:#f92672">=</span> cols[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>)], seg.len <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>, title <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(<span style="color:#a6e22e">bold</span>(<span style="color:#e6db74">&#39;Fonctions&#39;</span>)))
</span></span></code></pre></div><img src="/post/2017/Rintersects/RIntersects_files/figure-html/polyIntersect2-2.png" width="672" style="display: block; margin: auto;" />
<br/>
<p>We see here that <code>rgeos::gIntersects</code>, <code>sf::st_intersects</code>, <code>sf::st_intersection</code>
are far more efficient when dealing with polygons only intersects, with
<code>rgeos::gIntersects</code> the most efficient option. <code>raster::intersects</code> loses its
previous efficiency, while the efficiency of <code>rgeos::gIntersection</code> decreases
even further.</p>
<br/>
<h2 id="concluding-remarks">Concluding remarks</h2>
<p>Et voilÃ ! It is obvious from these simulations that the <code>sf</code> package overall
provides the most efficient options to perform spatial intersects in R.
<code>rgeos</code> is also very efficient when it comes to binary intersects, especially
with polygons on polygons intersects where it edges <code>st_intersects</code> by
decreasing calculation time in half.</p>
<p>Our recommendation: use <code>sf::st_intersects</code> for binary intersects and
use <code>sf::st_intersection</code> for zonal intersects. However, be aware that the <code>sf</code>
package evolves very rapidly and functions are likely to be modified,
although one would hope that efficiency decrease will not be the price of
further development.</p>
<p>If you wish to stick with the older packages, then binary intersects could be
done quite efficiently, but if you need zonal intersects, we recommend that you
start considering changing your ways!</p>
<br/>
<details>
<summary> Session info <i class="fa fa-cogs" aria-hidden="true"></i> </summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sessionInfo</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; R version 4.2.0 (2022-04-22)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; Running under: Debian GNU/Linux bookworm/sid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; Matrix products: default</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; locale:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; attached base packages:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; other attached packages:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [1] rgeos_0.5-9            raster_3.5-15          rgdal_1.5-32          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [4] sp_1.4-7               sf_1.0-7               kableExtra_1.3.4      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [7] knitr_1.39             magrittr_2.0.3         inSilecoRef_0.0.1.9000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; loaded via a namespace (and not attached):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [1] httr_1.4.3         sass_0.4.1         jsonlite_1.8.0     viridisLite_0.4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [5] bslib_0.3.1        shiny_1.7.1        assertthat_0.2.1   highr_0.9         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt;  [9] base64url_1.4      yaml_2.3.5         lattice_0.20-45    pillar_1.7.0      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [13] backports_1.4.1    glue_1.6.2         digest_0.6.29      promises_1.2.0.1  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [17] rvest_1.0.2        RefManageR_1.3.0   colorspace_2.0-3   htmltools_0.5.2   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [21] httpuv_1.6.5       plyr_1.8.7         pkgconfig_2.0.3    httpcode_0.3.0    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [25] bookdown_0.26      purrr_0.3.4        xtable_1.8-4       scales_1.2.0      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [29] webshot_0.5.3      processx_3.5.3     svglite_2.1.0      terra_1.5-21      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [33] later_1.3.0        tibble_3.1.6       proxy_0.4-26       generics_0.1.2    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [37] ellipsis_0.3.2     DT_0.23            withr_2.5.0        cli_3.3.0         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [41] crayon_1.5.1       mime_0.12          evaluate_0.15      ps_1.7.0          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [45] fansi_1.0.3        class_7.3-20       xml2_1.3.3         blogdown_1.10     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [49] tools_4.2.0        data.table_1.14.2  lifecycle_1.0.1    stringr_1.4.0     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [53] munsell_0.5.0      targets_0.12.0     callr_3.7.0        compiler_4.2.0    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [57] jquerylib_0.1.4    e1071_1.7-9        systemfonts_1.0.4  rlang_1.0.2       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [61] units_0.8-0        grid_4.2.0         classInt_0.4-3     rstudioapi_0.13   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [65] htmlwidgets_1.5.4  igraph_1.2.11      miniUI_0.1.1.1     rmarkdown_2.14    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [69] codetools_0.2-18   DBI_1.1.2          curl_4.3.2         R6_2.5.1          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [73] lubridate_1.8.0    dplyr_1.0.9        fastmap_1.1.0      utf8_1.2.2        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [77] rcrossref_1.1.0    KernSmooth_2.23-20 stringi_1.7.6      crul_1.2.0        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R&gt; [81] Rcpp_1.0.8.3       vctrs_0.4.1        tidyselect_1.1.2   xfun_0.30</span>
</span></span></code></pre></div></details>


      <div class="text-justify">
        

      </div>


    

    </center>

    </div>

      <br>

  
  <script>
    var $jq = jQuery.noConflict();
      $jq(function() {
          var toc = $jq("#toc").tocify({
            selectors: "h2, h3",
            scrollTo: 50
          }).data("toc-tocify");
    });
  </script>

  
  <script src="//yihui.name/js/math-code.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

  
  



  <h3 class="page-header">Comments on this post</h3>

  <div id="disqus_thread"></div>

  
  

  
    <h3 class="page-header">Related posts</h3>
     <div class="item-bottom">

  

  <h1>
    <a href="/2020/08/29/custom-tick-marks-with-rs-base-graphics-system/">Custom tick marks with R&#39;s base graphics system</a> <small>August 29, 2020</small>
  </h1>

  <p> <i class="fa fa-tags" aria-hidden="true"></i>  <a href="/tags/r"><kbd class="item-tag">R</kbd></a>  <a href="/tags/ticks"><kbd class="item-tag">ticks</kbd></a>  <a href="/tags/axes"><kbd class="item-tag">axes</kbd></a> </p>

  



  

</div>
  <div class="item-bottom">

  

  <h1>
    <a href="/2020/04/21/insilecomisc-0.4.0-part-2/2/">inSilecoMisc 0.4.0 (part 2/2)</a> <small>April 21, 2020</small>
  </h1>

  <p> <i class="fa fa-tags" aria-hidden="true"></i>  <a href="/tags/r"><kbd class="item-tag">R</kbd></a>  <a href="/tags/package"><kbd class="item-tag">package</kbd></a>  <a href="/tags/development"><kbd class="item-tag">development</kbd></a>  <a href="/tags/insilecomisc"><kbd class="item-tag">inSilecoMisc</kbd></a> </p>

  



  

</div>
  <div class="item-bottom">

  

  <h1>
    <a href="/2020/04/14/insilecomisc-0.4.0-part-1/2/">inSilecoMisc 0.4.0 (part 1/2)</a> <small>April 14, 2020</small>
  </h1>

  <p> <i class="fa fa-tags" aria-hidden="true"></i>  <a href="/tags/r"><kbd class="item-tag">R</kbd></a>  <a href="/tags/package"><kbd class="item-tag">package</kbd></a>  <a href="/tags/development"><kbd class="item-tag">development</kbd></a>  <a href="/tags/insilecomisc"><kbd class="item-tag">inSilecoMisc</kbd></a> </p>

  



  

</div>
 
  





  <script>
    


    var disqus_config = function() {
      this.page.url = "https://insileco.github.io" + "https://insileco.github.io/2017/09/12/efficiency-of-spatial-intersects-in-r/"; 
      this.page.identifier = "Efficiency of spatial intersects in R"; 
    };

    (function() { 
      var d = document,
        s = d.createElement('script');
      s.src = 'https://insileco.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>


</div>


</div>

        <footer>

          <script src="//yihui.name/js/math-code.js"></script>
          <script async
            src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
          </script>

            <hr>
            <p class="copyright text-muted" style="font-size: 1.6rem;">
              &copy; 2017-2022 inSileco |
              All rights reserved |
              Powered by <a href="https://bookdown.org/yihui/blogdown/">Blogdown</a>,
                <a href="https://gohugo.io">Hugo</a>
                and <a href="https://github.com/calintat/minimal">Minimal</a> |
              Latest build: 19 Jun 2022 21:07 UTC.
              </p>

        </footer>

    </body>

</html>

