<!DOCTYPE html>
<html lang="en-us">

    <head>

        <title>Continuous integration for R projects: from Travis CI to GitHub actions step by step</title>

        <style>

    html body {
        font-family: Lato, sans-serif;
        background-color: white;
    }

    :root {
        --accent: #3fb3b2;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/css/main.css">



  <link rel="stylesheet" href="/css/academicons.min.css">

  <link rel="stylesheet" href="/css/font-awesome.min.css">

  <link rel="stylesheet" href="/css/insileco.css">

  <link rel="stylesheet" href="/css/jquery.tocify.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">

  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">



<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">


 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
 


    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

    

    <script>hljs.initHighlightingOnLoad();</script>





  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



  <script src="/js/jquery-1.8.3.min.js"></script>

  <script src="/js/jquery-ui-1.9.1.custom.min.js"></script>

  <script src="/js/jquery.tocify.min.js"></script>


        <meta charset="utf-8">

        <meta name="viewport" content="width=device-width, initial-scale=1">

        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109508556-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());
          gtag('config', 'UA-109508556-1');
        </script>
        


    </head>

    <body>

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Continuous integration for R projects: from Travis CI to GitHub actions step by step</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/about/">About</a></li>
                            
                                <li><a href="https://insilecoinc.github.io/">Consulting</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/software/">Software</a></li>
                            
                                <li><a href="/wiki/">Wiki</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/inSileco/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/inSileco/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://insileco.github.io/index.xml"><i class="fa fa-rss"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<img class="full-width" width="100%" src="/img/banner4.png"></img>


<div>

  <div class="col-md-3">
      <div class="hidden-sm hidden-xs">
        <div class="sticky-top">
          <div id="toc"></div>

        </div>
    </div>
  </div>


  <div class="col-md-8">

    <h1><a href="/2020/11/24/continuous-integration-for-r-projects-from-travis-ci-to-github-actions-step-by-step/">Continuous integration for R projects: from Travis CI to GitHub actions step by step</a></h1>

    <h4>November 24, 2020</h4>

    <p>
      <i class="fa fa-tags" aria-hidden="true"></i> &nbsp;  <a href="/tags/continuous-integration"><kbd class="item-tag">Continuous Integration</kbd></a>  <a href="/tags/travis-ci"><kbd class="item-tag">Travis CI</kbd></a>  <a href="/tags/github-actions"><kbd class="item-tag">GitHub Actions</kbd></a>  <a href="/tags/r-package"><kbd class="item-tag">R package</kbd></a> 
      <br>
      
       <img src = "/img/Rlogo.svg" title="List of R packages required for this post." width="7%"></img> &nbsp;  <a href="/rpkgs/covr"><kbd class="item-tag2">covr</kbd></a>  <a href="/rpkgs/pkgdown"><kbd class="item-tag2">pkgdown</kbd></a>  <a href="/rpkgs/usethis"><kbd class="item-tag2">usethis</kbd></a> 
      
    </p>

    
      <p style = "font-size: 1.6em;"> <i class="fa fa-pencil" aria-hidden="true" title="Author(s)"></i>
       
        <a href="/about/">Kevin Cazelles</a> &nbsp;
      
     <a href="#"></a></p>
    

    
      <p> <i class="fa fa-check-square" aria-hidden="true", title="Reviewer(s)"></i>
       
      <a href="/about/">Marie-Hélène Brice</a> &nbsp;
       
      <a href="/about/">Willian Vieira</a> &nbsp;
      
      <a href="#"></a></p>
    

    <p>
    
    
    
      <img src='https://img.shields.io/static/v1?style=flat&amp;label=reading%20time&amp;message=5min&amp;color=3fb3b2&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA/1BMVEU/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7I/s7L////QnMRFAAAAVHRSTlMAAyRgm8Pa5C&#43;GyOPo5xV40unq3y2szJpqSjw3wcVtIwTikCLebwkBeQUQHTB30ZgHAojvroftrQjNS4nsBmfcKbbLbBMXdOvmsUgynn8LWMBxIGRFHj3/AAAAAWJLR0RU5AOIpQAAAAlwSFlzAAAN5QAADeUB5upprwAAAAd0SU1FB&#43;QEBQceG9g0RXAAAAFvSURBVDjLhVPXdoJAEF0BQdwZZMHeKIolMUbTJb2aXv//X4IFZD16uC8wu3fKztwhJERKEKW0rChyWhKFFFlHKqNmKQAGAKBZNbNG0XI6AzCAmiYNPsD0nBa/zxcCPyyWypVqtVIuFWdWIb&#43;6r9UZQqNp2QvTtpoNQFavRf7BveO24iFbrhMwljG0AsO21&#43;GL6nhtZIV5Hd0eouP1F&#43;c7u1p38df3HMTezBjoAG7ovzfcH4UxXAB9QMhYZdCwwsgHh0dRLqsBTB0TIQvYjFIfn5yeRUYTISsQkcJE2EwQJkBFIoFRsjcT7JIBEkkDlMlmAikDpImM1N9G8CnKREGzyhFiHauaqKwRzi8m/iVP4FNcmca1e9ONp&#43;CLHPm3aNzdP8SK5J9JyOPTcPr88jqKnsk3KsD47d2Ztj8uw0bxrZ7j8&#43;sbf6JW88Na4vdPi4bFjzsumeW4ecGssBJMouSSRZss&#43;&#43;TFSV695OUlW9f/HyniMFbfN&#43;2lAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTA0LTA1VDExOjMwOjUyLTA0OjAwwJKD8wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wNC0wNVQxMTozMDoyNy0wNDowMOkyHfEAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC'>
    
    
    
      <a href="http://www.R-bloggers.com">
      <img src="https://img.shields.io/static/v1?style=flat&label=shared on&message=R-bloggers&logo=rss&color=6d4f5b">
      <a>
     &nbsp;
    
    
      <a href = "https://creativecommons.org/licenses/by/4.0/">
      <img src="https://img.shields.io/static/v1?style=flat&label=license&message=CC-BY-4.0&color=f76f2b&logo=creative-commons">
      </a>
     &nbsp;
    
     &nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;
    <a href="http://twitter.com/share?url=https%3a%2f%2finsileco.github.io%2f2020%2f11%2f24%2fcontinuous-integration-for-r-projects-from-travis-ci-to-github-actions-step-by-step%2f&text=Continuous%20integration%20for%20R%20projects%3a%20from%20Travis%20CI%20to%20GitHub%20actions%20step%20by%20step" target="_blank">
      <img src='https://img.shields.io/twitter/url?style=social&url=https%3a%2f%2finsileco.github.io%2f2020%2f11%2f24%2fcontinuous-integration-for-r-projects-from-travis-ci-to-github-actions-step-by-step%2f?link=http://left&link=http://right}'>
    </a>
  </p>


    <br>

    <div class="text-justify">

      


<p>I have been using Travis CI (<a href="https://travis-ci.org/" class="uri">https://travis-ci.org/</a>) since 2015 and GitHub
Actions (hereafter GH Actions; <a href="https://github.com/features/actions" class="uri">https://github.com/features/actions</a>) for over a
year now<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. While using these two hosted continuous integration services,
I came to realize that I was spending less time troubleshooting with GH Actions
than I was with Travis. For this reason, I am now setting GH Actions workflows
for my new projects (mainly R and Julia projects) and slowly migrating older
projects from Travis to GH Actions. Turns out that was the right move! Indeed,
as Jeroen Ooms explains in his recent post <a href="https://discuss.ropensci.org/t/ropensci-moving-away-from-travis-ci/2267">“Moving away from Travis
CI”</a>,
by next year, <a href="https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing">Travis will no longer be free for open source
projects</a> (see
<a href="https://www.theregister.com/2020/11/02/travis_ci_pricng/">also</a>), which gives
me a good reason to speed up the migration process! As I was working on such
migration recently, I felt that I should to share some notes about this!</p>
<div id="insilecomisc-as-an-example" class="section level2">
<h2>inSilecoMisc as an example</h2>
<p>The package I worked on was
<a href="https://github.com/inSileco/inSilecoMisc"><code>inSilecoMisc</code></a>. Note that I have
already detailed elsewhere various features including in inSilecoMisc (e.g.
<a href="https://insileco.github.io/2020/04/14/insilecomisc-0.4.0-part-1/2/">here</a> and
<a href="https://insileco.github.io/2020/04/21/insilecomisc-0.4.0-part-2/2/">there</a>).
What matters here, is what was Travis CI doing for me. The screenshot below
shows the different jobs I set (described in
<a href="https://github.com/inSileco/inSilecoMisc/blob/38724e2e9710fb35d87fe1b69aaae8fe4e8cdeff/.travis.yml">.travis.yml</a>).</p>
<div class="figure">
<img src="on_travis.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the inSilecoMisc project page on <a href="https://travis-ci.org/">travis-ci.org</a>.</p>
</div>
<p>Travis was set to check <code>inSilecoMisc</code> on macOS and Linux (Ubuntu Bionic and Focal), for different versions of R (oldrel, rel and devel). The last job, checked the package on Ubuntu Focal, uploaded <a href="https://CRAN.R-project.org/package=covr"><code>covr</code></a> results to
<a href="https://codecov.io">CodeCov</a>, built <code>inSilecoMisc</code>’s website (via <a href="https://CRAN.R-project.org/package=pkgdown"><code>pkgdown</code></a>) and deploy to a <a href="https://pages.github.com/">GitHub Pages</a>. So my goal was to set up a workflow with GitHub Actions that would do the same jobs.</p>
</div>
<div id="ciao-travis" class="section level2">
<h2>Ciao Travis!</h2>
<p>The first step was to stop using Travis CI. To do so, I first needed to go on
<a href="https://travis-ci.org" class="uri">https://travis-ci.org</a> and turn off the jobs described above, so I looked for <code>inSilecoMisc</code> in my list of projects and switched it off (see screenshot below).</p>
<div class="figure">
<img src="switch_off.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshots of <code>inSilecoMisc</code>’s status on <a href="https://travis-ci.org" class="uri">https://travis-ci.org</a> (left: on/before, right: off/after).</p>
</div>
<p>Then, as I was using a <a href="https://developer.github.com/v3/guides/managing-deploy-keys/">deploy
key</a> for the
website, I deleted it in the settings on GitHub repository (<i class="fa
fa-arrow-circle-down" aria-hidden="true"></i>). Last, on my local <i class="fa
fa-git" aria-hidden="true"></i> repository I removed <code>.travis.yaml</code> (e.g. <code>git rm .travis.yaml</code>). Note that I still have a version of this file as a
<a href="https://gist.github.com/KevCaz/622c92cc1f7b00e66f078418882ad407">gist</a>. Once
this was done, I committed my changes and pushed!</p>
<div class="figure">
<img src="ciao.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of <code>inSileco</code>’s home page (commit <a href="https://github.com/inSileco/inSilecoMisc/commit/500d5ef332a407e48037ce422a9a14e7c4634fe7"><code>500d5ef</code></a>).</p>
</div>
</div>
<div id="add-a-workflow" class="section level2">
<h2>Add a workflow</h2>
<p><a href="https://github.com/features/actions">GH Actions</a> are well-documented and my
goal here is not to explain how to set an entire workflow. Rather I would like
to focus on certain part of the workflow. That said, one should keep in mind
that thanks to <a href="https://www.docker.com/">Docker</a> images and the large diversity
of Actions available, GH Actions are powerful and extremely flexible. For R
users interested in using GH Actions to check their package, it is worth noting
that <a href="https://CRAN.R-project.org/package=usethis"><code>usethis</code></a> has several
functions to add such workflows:</p>
<pre class="r"><code>library(usethis)
use_github_action() 
# there are different level of completeness, see the documentation 
# and select the one you need! 
use_github_action_check_release()
use_github_action_check_standard()
use_github_action_check_full()</code></pre>
<p>The workflow I ended up using, <a href="https://github.com/inSileco/inSilecoMisc/blob/master/.github/workflows/R-CMD-check.yaml">R-CMD-check.yaml</a> (appended at the end of the post) is based on one of the template file available in <a href="https://CRAN.R-project.org/package=usethis"><code>usethis</code></a>
that I’ve simplified a bit (I use only 4 combinations OS / R versions) and extended to use the <a href="chttps://codecov.io/">CodeCov</a> and deploy the website.</p>
</div>
<div id="code-coverage" class="section level2">
<h2>Code coverage</h2>
<p>To use <a href="chttps://codecov.io/">CodeCov</a> with Actions, a token is required. So, I clicked on the <code>Settings</code> tab of the <code>inSilecoMisc</code> page and copied the upload token:</p>
<div class="figure">
<img src="codecov.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the CodeCov settings page of <code>inSilecoMisc</code>.</p>
</div>
<p>Then I created a new secret <code>CODECOV_TOKEN</code> on <code>inSileco</code>’s GitHub repository and I pasted the token.</p>
<div class="figure">
<img src="token_codecov.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the Secret tab of the setting of the GitHub <code>inSilecoMisc</code> repository.</p>
</div>
<p>I chose <code>CODECOV_TOKEN</code> because it’s pretty clear, but the name does not matter as long as the same variable name is used in <a href="https://github.com/inSileco/inSilecoMisc/blob/master/.github/workflows/R-CMD-check.yaml">R-CMD-check.yaml</a>. Below is the code bloc in the workflow that handles code coverage:</p>
<pre class="yaml"><code>- name: Test coverage
  if: matrix.config.os == &#39;macOS-latest&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
  run: |
    remotes::install_cran(&quot;covr&quot;)
    covr::codecov(token = &quot;${{secrets.CODECOV_TOKEN}}&quot;)
  shell: Rscript {0}</code></pre>
<p>Note that <code>${{secrets.CODECOV_TOKEN}}</code> returns the token value I set as a secret
above. Also, I used an <code>if:</code> filed to upload the results of the code coverage
only once. I chose to do it on MacOS (for no specific reason) and I kept the
part <code>matrix.config.r == 'release'</code> in case I would add another configuration
(currently, this is useless).</p>
</div>
<div id="website" class="section level2">
<h2>Website</h2>
<div id="build" class="section level3">
<h3>Build</h3>
<p>In order to build the package I simply install <a href="https://CRAN.R-project.org/package=pkdown"><code>pkgdown</code></a> and use it to generates the HTML pages. Below is the code bloc I wrote for this:</p>
<pre class="yaml"><code>- name: Build website 
  if: matrix.config.os == &#39;ubuntu-20.04&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
  run: |
    mkdir docs
    sudo apt-get install libcurl4-openssl-dev libharfbuzz-dev libfribidi-dev
    git fetch origin gh-pages:gh-pages
    git --work-tree=docs checkout gh-pages -- .
    Rscript -e &#39;remotes::install_cran(c(&quot;pkgdown&quot;)); pkgdown::build_site()&#39;</code></pre>
<p>There are a few lines that require some explanations. First, I decided to build this on Ubuntu (again, this is arbitrary). Second, the following line:</p>
<pre class="sh"><code>sudo apt-get install libcurl4-openssl-dev libharfbuzz-dev libfribidi-dev</code></pre>
<p>was required as dependencies were missing for
<a href="https://CRAN.R-project.org/package=curl"><code>curl</code></a> and
<a href="https://CRAN.R-project.org/package=textshaping"><code>textshaping</code></a>. Third, the two
last lines are two git operations that I used to retrieve te content of the
previous commit. I did so to be able to have both the “main” website at
<a href="https://insileco.github.io/inSilecoMisc/" class="uri">https://insileco.github.io/inSilecoMisc/</a> and “dev” version at
<a href="https://insileco.github.io/inSilecoMisc/dev" class="uri">https://insileco.github.io/inSilecoMisc/dev</a> (this is detailed in another post
<a href="https://kevcaz.github.io/notes/ci/deploypkgdown2/">“Deploy a pkgdown website on gh-pages
manually”</a>).</p>
</div>
<div id="deploy" class="section level3">
<h3>Deploy</h3>
<p>To deploy the website to <a href="https://pages.github.com/">GitHub Pages</a>, I used
<a href="https://github.com/peaceiris/actions-gh-pages"><code>peaceiris/actions-gh-pages</code></a>
(version 3). There are two
ways to deploy the website that are well explained in the README of
<a href="https://github.com/peaceiris/actions-gh-pages"><code>peaceiris/actions-gh-pages</code></a>.</p>
</div>
<div id="via-a-deploy-key" class="section level3">
<h3>via a deploy key</h3>
<p>For this, one needs to generate a <a href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key">pair of ssh
keys</a>.
On my Debian machine, I used the following command line in my terminal:</p>
<pre class="sh"><code>$ ssh-keygen -t rsa -b 4096 -C &quot;$(git config user.email)&quot; -f gh-pages</code></pre>
<p>Then I set the public key as a deploy key</p>
<div class="figure">
<img src="deploy_key.png" alt="&gt;&lt;" style="width:80.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the deploy key setting.</p>
</div>
<p>and the private one as a secret.</p>
<div class="figure">
<img src="private.png" alt="&gt;&lt;" style="width:80.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the secret <code>ACTIONS_DEPLOY_KEY</code>.</p>
</div>
<p>Again, I chose <code>ACTIONS_DEPLOY_KEY</code> for its clarity, but the name does not
matter as long as the correct variable name is used in
<a href="https://github.com/inSileco/inSilecoMisc/blob/master/.github/workflows/R-CMD-check.yaml">R-CMD-check.yaml</a>.</p>
<pre class="yaml"><code>- name: Deploy website 
  if: matrix.config.os == &#39;ubuntu-20.04&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
  uses: peaceiris/actions-gh-pages@v3
  with:
    deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
    publish_dir: ./docs</code></pre>
<p>I used <code>publish_dir: ./docs</code> as this is where <a href="https://CRAN.R-project.org/package=pkgdown"><code>pkgdown</code> stores</a> stored the web pages in my case
(see the file
<a href="https://github.com/inSileco/inSilecoMisc/blob/master/_pkgdown.yml">_pkgdown.yml</a>).
Note that I didn’t need to specify the branch to be used for the website as
the default is <code>gh-pages</code> and I already had a branch <code>gh-pages</code> set up<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
</div>
<div id="via-a-personal-access-token" class="section level3">
<h3>via a personal access token</h3>
<p>The second option is to <a href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token">create and use a personal access token</a> (this is the solution I opted for in the end).</p>
<div class="figure">
<img src="perso_token.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the page to generate the personal token.</p>
</div>
<p>And then set this token as a secret for the repository.</p>
<div class="figure">
<img src="pat_secret.png" alt="&gt;&lt;" style="width:90.0%" />
<p class="caption"><i class="fa fa-info" aria-hidden="true"></i> Screenshot of the secret <code>PERSO_TOKEN</code>.</p>
</div>
<p>Once the secret is set, the variable name should be passed as <code>github_token</code> (instead of <code>deploy_key</code>), like so:</p>
<pre class="yaml"><code>- name: Deploy website 
  if: matrix.config.os == &#39;ubuntu-20.04&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
  uses: peaceiris/actions-gh-pages@v3
  with:
    github_token: ${{ secrets.PERSO_TOKEN }}
    publish_dir: ./docs</code></pre>
<p>Incidentally, <a href="https://github.blog/changelog/2020-05-14-organization-secrets/">organization secrets</a> allow user to have secrets at the organisation level, so that the same token can be used for several repositories!</p>
<p><br/></p>
<p>Everything is working fine now 🎆, check out <a href="https://github.com/inSileco/inSilecoMisc"><code>inSilecoMisc</code></a>! Below is the entire workflow</p>
</div>
</div>
<div id="entire-workflow" class="section level2">
<h2>Entire workflow</h2>
<p>Below is the whole <a href="https://github.com/inSileco/inSilecoMisc/blob/master/.github/workflows/R-CMD-check.yaml">R-CMD-check.yaml</a> file I ended using (note that for recent projects <a href="https://github.blog/changelog/2020-08-26-set-the-default-branch-for-newly-created-repositories/">the default branch name is <code>main</code> instead of <code>master</code></a>).</p>
<pre class="yaml"><code>on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

name: R-CMD-check

jobs:
  R-CMD-check:
    runs-on: ${{ matrix.config.os }}

    name: ${{ matrix.config.os }} (${{ matrix.config.r }})

    strategy:
      fail-fast: false
      matrix:
        config:
          - {os: windows-latest, r: &#39;release&#39;}
          - {os: macOS-latest, r: &#39;release&#39;}
          - {os: ubuntu-20.04, r: &#39;release&#39;, rspm: &quot;https://packagemanager.rstudio.com/cran/__linux__/focal/latest&quot;}
          - {os: ubuntu-20.04, r: &#39;devel&#39;, rspm: &quot;https://packagemanager.rstudio.com/cran/__linux__/focal/latest&quot;}

    env:
      R_REMOTES_NO_ERRORS_FROM_WARNINGS: true
      CRAN: ${{ matrix.config.cran }}

    steps:
      - uses: actions/checkout@v1

      - uses: r-lib/actions/setup-r@master
        with:
          r-version: ${{ matrix.config.r }}

      - uses: r-lib/actions/setup-pandoc@master

      - name: Query dependencies
        run: |
          install.packages(&#39;remotes&#39;)
          saveRDS(remotes::dev_package_deps(dependencies = TRUE), &quot;depends.Rds&quot;, version = 2)
        shell: Rscript {0}

      - name: Cache R packages
        if: runner.os != &#39;Windows&#39;
        uses: actions/cache@v1
        with:
          path: ${{ env.R_LIBS_USER }}
          key: ${{ runner.os }}-r-${{ matrix.config.r }}-${{ hashFiles(&#39;depends.Rds&#39;) }}
          restore-keys: ${{ runner.os }}-r-${{ matrix.config.r }}-

      - name: Install system dependencies
        if: runner.os == &#39;Linux&#39;
        env:
          RHUB_PLATFORM: linux-x86_64-ubuntu-gcc
        run: |
          Rscript -e &quot;remotes::install_github(&#39;r-hub/sysreqs&#39;)&quot;
          sysreqs=$(Rscript -e &quot;cat(sysreqs::sysreq_commands(&#39;DESCRIPTION&#39;))&quot;)
          sudo -s eval &quot;$sysreqs&quot;
      - name: Install dependencies
        run: |
          library(remotes)
          deps &lt;- readRDS(&quot;depends.Rds&quot;)
          deps[[&quot;installed&quot;]] &lt;- vapply(deps[[&quot;package&quot;]], remotes:::local_sha, character(1))
          update(deps)
          remotes::install_cran(&quot;rcmdcheck&quot;)
        shell: Rscript {0}

      - name: Check
        run: rcmdcheck::rcmdcheck(args = &quot;--no-manual&quot;, error_on = &quot;warning&quot;, check_dir = &quot;check&quot;)
        shell: Rscript {0}

      - name: Upload check results
        if: failure()
        uses: actions/upload-artifact@master
        with:
          name: ${{ runner.os }}-r${{ matrix.config.r }}-results
          path: check

      - name: Test coverage
        if: matrix.config.os == &#39;macOS-latest&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
        run: |
          remotes::install_cran(&quot;covr&quot;)
          covr::codecov(token = &quot;${{secrets.CODECOV_TOKEN}}&quot;)
        shell: Rscript {0}
    
      - name: Build website 
        if: matrix.config.os == &#39;ubuntu-20.04&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
        run: |
          sudo apt-get install libcurl4-openssl-dev libharfbuzz-dev libfribidi-dev
          mkdir docs
          git fetch origin gh-pages:gh-pages
          git --work-tree=docs checkout gh-pages -- .
          Rscript -e &#39;remotes::install_cran(c(&quot;pkgdown&quot;)); pkgdown::build_site()&#39;
            
      - name: Deploy website 
        if: matrix.config.os == &#39;ubuntu-20.04&#39; &amp;&amp; matrix.config.r == &#39;release&#39;
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.PERSO_TOKEN }}
          publish_dir: ./docs</code></pre>
<p>Hope this could be of help 😄!</p>
<p><br/></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>see <a href="https://kevcaz.github.io/notes/ci/githubactions/">my first post about GitHub Actions</a> on my personal blog.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Use <code>publish_branch: your-branch</code> to set <code>your-branch</code> as the branch were files will be published.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>


      <div class="text-justify">
        
          <div class="edits">
            <h4><b><i class="fa fa-edit" aria-hidden="true"></i> Edits</b></h4>
            <p style="font-size: 1.5rem">
              
              <i class="fa fa-pencil" aria-hidden="true"></i> May 21, 2021 -- Edit the tricks to keep both the versions of the website (dev and last releases). <br>
              
            </p>
          </div>
        

      </div>


    

    </center>

    </div>

      <br>

  
  <script>
    var $jq = jQuery.noConflict();
      $jq(function() {
          var toc = $jq("#toc").tocify({
            selectors: "h2, h3",
            scrollTo: 50
          }).data("toc-tocify");
    });
  </script>

  
  <script src="//yihui.name/js/math-code.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

  
  



  <h3 class="page-header">Comments on this post</h3>

  <div id="disqus_thread"></div>

  
  

  





  <script>
    


    var disqus_config = function() {
      this.page.url = "https://insileco.github.io" + "https://insileco.github.io/2020/11/24/continuous-integration-for-r-projects-from-travis-ci-to-github-actions-step-by-step/"; 
      this.page.identifier = "Continuous integration for R projects: from Travis CI to GitHub actions step by step"; 
    };

    (function() { 
      var d = document,
        s = d.createElement('script');
      s.src = 'https://insileco.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>


</div>


</div>

        <footer>

          <script src="//yihui.name/js/math-code.js"></script>
          <script async
            src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
          </script>

            <hr>
            <p class="copyright text-muted" style="font-size: 1.6rem;">
              &copy; 2017-2022 inSileco |
              All rights reserved |
              Powered by <a href="https://bookdown.org/yihui/blogdown/">Blogdown</a>,
                <a href="https://gohugo.io">Hugo</a>
                and <a href="https://github.com/calintat/minimal">Minimal</a> |
              Latest build: 19 Jun 2022 21:34 UTC.
              </p>

        </footer>

    </body>

</html>

