<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="David Beauchesne &amp; Kevin Cazelles" />


<title>Animations in R: Time series of erythemal irradiance in the St. Lawrence</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" href="css/academicons.css"/>
<link type="text/css" rel="stylesheet" href="css/creativecommons.css"/>
<link type="text/css" rel="stylesheet" href="css/perso.css"/>
<link type="text/css" rel="stylesheet" href="css/flag-icon.css"/>
<!-- js libraries -->
<!-- favicon -->
<link rel="icon" type="image/png" href="img/favicon.png" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">inSilico Blog</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="softwares.html">Softwares</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Posts
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="indexPosts.html">Index of our blog posts</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">R and graphs</li>
    <li>
      <a href="Rgraphpkgs.html">List of R graph packages</a>
    </li>
    <li>
      <a href="HylianStyle.html">Hylian Style</a>
    </li>
    <li>
      <a href="AcademiconsInR.html">Icons on you plots</a>
    </li>
    <li>
      <a href="AnimationInR.html">Animations in R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ecology and R</li>
    <li>
      <a href="OnlineEcology-Species.html">Individual species description</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Code tips</li>
    <li>
      <a href="Codetips0001.html">Code tips 0001</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="ion ion-plus-circled"></span>
     
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="maps.html">Maps</a>
    </li>
    <li>
      <a href="talks.html">Talks</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Presentations</li>
    <li>
      <a href="pres/pres1.html">pres1</a>
    </li>
    <li>
      <a href="pres/presex.html">presex</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/letiR/letiR_website">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Animations in R: Time series of erythemal irradiance in the St. Lawrence</h1>
<h4 class="author"><em>David Beauchesne &amp; Kevin Cazelles</em></h4>
<h4 class="date"><em>June 19, 2017 – last update on July 7, 2017</em></h4>

</div>


<p><i class='fa fa-cogs' aria-hidden='true'></i>   <img src="https://img.shields.io/badge/letiR-inDevelopment-yellow.svg" /> <img src="https://img.shields.io/badge/pgmLang-R(%3E=3.0.0)-blue.svg" /> <br/><i class='fa fa-download' aria-hidden='true'></i>   <i class='fa fa-code' aria-hidden='true'></i> <a href='assets/AnimationInR/AnimationInR.Rmd'>Rmd file </a>   <i class='fa fa-code' aria-hidden='true'></i> <a href='assets/AnimationInR/AnimationInR.R'>R only </a>   <br/><i class='fa fa-tags' aria-hidden='true'></i>    <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#plot'>Plot</a> <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#r'>R</a> <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#animation'>Animation</a> <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#nasa'>NASA</a> <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#radiation'>Radiation</a> <a class='btn btn-primary btn-outline btn-xs' href='indexPosts.html#st._lawrence'>St. Lawrence</a><br/><br/><a class='twitter-share-button' href='https://twitter.com/intent/tweet?text=Animations%20in%20R:%20Time%20series%20of%20erythemal%20irradiance%20in%20the%20St.%20Lawrence&url=https://letir.github.io/docs/AnimationInR.html'>Tweet</a></p>
<p><br/></p>
<div id="the-need-for-animations" class="section level2">
<h2>The “<em>need</em>” for animations</h2>
<p><br/></p>
<p>As part of my PhD thesis, I am currently characterizing the intensity of multiple stressors in the estuary and gulf of St. Lawrence (see ResearchGate <a href="https://www.researchgate.net/project/Evaluating-the-cumulative-impacts-of-human-activities-on-the-structure-and-function-the-trophic-network-of-the-estuary-and-gulf-of-StLawrence">project</a> for more details). I have recently <em>needed</em> (read: <em>thought it would be cool</em>) to create an animation of the temporal variations in ultra-violet intensity in the St. Lawrence. Here is how I did it.</p>
<p><br/></p>
</div>
<div id="setting-up-r" class="section level2">
<h2>Setting up R</h2>
<div id="r-version-used-to-build-the-last-update-of-this-post" class="section level3">
<h3>R version used to build the last update of this post</h3>
<pre class="r"><code>sessionInfo()[[1]]$version.string</code></pre>
<pre><code>## [1] &quot;R version 3.4.1 (2017-06-30)&quot;</code></pre>
<p><br/></p>
</div>
<div id="installing-imagemagick" class="section level3">
<h3>Installing imagemagick</h3>
<p>The package <code>animation</code>, which I used to create the animations in R, works with the application <a href="https://www.imagemagick.org/script/index.php"><code>imagemagick</code></a>, which can be installed using <a href="https://brew.sh/"><code>Homebrew</code></a>.</p>
<p><br/></p>
<p><code>brew install imagemagick</code></p>
<p><br/></p>
</div>
<div id="installing-the-package-animation" class="section level3">
<h3>Installing the package animation</h3>
<p><code>install.packages('animation', repos = 'http://yihui.name/xran')</code></p>
<p><br/></p>
</div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>There is a incredible amount of data available on the <a href="https://disc.gsfc.nasa.gov/uui/datasets?keywords=%22Aura%20OMI%22">NASA website</a>. For this post, we downloaded all available data from NASA’s Ozone Monitoring Instrument (OMI) aboard the Earth Observing System’s (EOS) Aura satellite. More specifically, we used <a href="https://disc.gsfc.nasa.gov/uui/datasets/OMUVBG_V003/summary?keywords=%22Aura%20OMI%22">OMI/Aura Surface UVB Irradiance and Erythemal Dose Daily at a scale of 0.25 x 0.25 degree</a> and selected the daily erythemal irradiance (mW/m<sup>2</sup>), <em>i.e.</em> the potentially harmful range of UV radiations, from October 1<sup>st</sup> 2004 to April 5<sup>th</sup> 2017. We then selected only the years with 12 months worth of data to create the following figures, <em>i.e.</em> from January 1<sup>st</sup> 2005 to December 31<sup>st</sup> 2016. The resulting dataset is available here in the <a href="https://github.com/letiR/letir.github.io/blob/master/data/MonthOMI.rds">letiR github page</a></p>
<p>The maps generated in this post require the user to load <a href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/ne_10m_ocean.zip"><code>ocean</code></a> shapefile from <a href="http://www.naturalearthdata.com/">Natural Earth</a>.</p>
<p><br/></p>
<pre class="r"><code># UV data
    UV &lt;- readRDS(&#39;./data/MonthOMI.rds&#39;)

# Projection
    spatProj &lt;- &#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&#39;

# Ocean shapefile
    ocean &lt;- readOGR(dsn = &quot;./data/shpfile/&quot;, layer = &quot;ne_10m_ocean&quot;) %&gt;%
             spTransform(CRSobj = CRS(spatProj))</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;./data/shpfile/&quot;, layer: &quot;ne_10m_ocean&quot;
## with 1 features
## It has 2 fields</code></pre>
<pre class="r"><code>    class(ocean)</code></pre>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p><br/></p>
</div>
<div id="set-parameters-and-functions" class="section level2">
<h2>Set parameters and functions</h2>
<p>We start be setting the different parameters and functions required to build the animation.</p>
<p><br/></p>
<pre class="r"><code># Graphical parameters
    min_ &lt;- min(UV[[1]], na.rm = T) %&gt;% plyr::round_any(., 100, floor) # Minimum values in UV dataset
    max_ &lt;- max(UV[[1]], na.rm = T) %&gt;% plyr::round_any(., 100, ceiling) # Minimum values in UV dataset
    ext &lt;- c(-72, -54, 44, 53) # c(xmin, xmax, ymin, ymax)
    rbPal &lt;- colorRampPalette(c(&#39;#2f6eb9&#39;,&#39;#2aadba&#39;,&#39;#c4c726&#39;,&#39;#b45f5f&#39;)) # color palette
    labels &lt;- matrix(seq(4,(151-4)), ncol = 12, nrow = 12, dimnames = list(2005:2016, month.abb), byrow = T)  # Select only full years (start: 2004/10; end: 2017/04)

# Monthly trends
    monthMean &lt;- apply(X = UV[[1]], MARGIN = 3, FUN = mean, na.rm = T) # monthly mean
    monthSd &lt;- apply(X = UV[[1]], MARGIN = 3, FUN = sd, na.rm = T) # monthly sd
    years &lt;- 2005:2016
    lowCI &lt;- monthMean - (1.96*monthSd) # Lower confidence interval
    upCI &lt;- monthMean + (1.96*monthSd) # Upper confidence interval

# Empty plot function
    eplot &lt;- function(x = 1, y = 1, xmin = 0, xmax = 1, ymin = 0, ymax = 1) {
      plot(x = x,y = y,bty = &quot;n&quot;,ann = FALSE,xaxt = &quot;n&quot;,yaxt = &quot;n&quot;,type = &quot;n&quot;,bg = &#39;grey&#39;,ylim = c(ymin,ymax),xlim = c(xmin,xmax))
    }

# Legend function
    colorBar &lt;- function(colRamp, min, max, nticks=11, ticks=seq(min, max, len=nticks)) {
        scale = (length(colRamp)-1)/(max-min)
        par(mar = c(5,0.5,5,4))
        plot(c(0,10), c(min_,max_), type=&#39;n&#39;, bty=&#39;n&#39;, xaxt=&#39;n&#39;, xlab=&#39;&#39;, yaxt=&#39;n&#39;, ylab=&#39;&#39;)
        axis(4, ticks, las=1, cex = 1.5)
        for (i in 1:(length(colRamp)-1)) {
            y = (i-1)/scale + min
            rect(0,y,10,y+1/scale, col=colRamp[i], border=NA)
        }
    }</code></pre>
<p><br/></p>
</div>
<div id="create-first-animation" class="section level2">
<h2>Create first animation</h2>
<p>Let’s start with a simple animation of erythemal irradiance for 2005.</p>
<p><br/></p>
<pre class="r"><code>saveGIF({
        for(i in 1:ncol(labels)){
            par(mar = c(0,0,0,0), pch = 21,  xaxs = &quot;i&quot;, yaxs = &quot;i&quot;, family = &quot;serif&quot;)
            r &lt;- raster::raster(UV[[1]][,,labels[1,i]], xmn = ext[1], xmx = ext[2], ymn = ext[3], ymx = ext[4], crs = spatProj) %&gt;%
                mask(ocean)
            eplot(xmin = ext[1], xmax = ext[2], ymin = ext[3], ymax = ext[4])
            plot(r, col= rbPal(100), breaks = seq(min_,max_,length.out=100), legend = F, add = T)
            plot(ocean, add = T, lwd = 2)
            text(x = -54.5, y = 45, labels = paste(colnames(labels)[1], rownames(labels)[i]), adj = 1, cex = 1.5)
        }
}, movie.name = &quot;UV2005animate.gif&quot;)</code></pre>
<p><br/></p>
<div class="figure">
<img src="assets/img/UV2005animate.gif" />

</div>
<p><br/></p>
</div>
<div id="create-complex-animation" class="section level2">
<h2>Create complex animation</h2>
<p>Now let’s make a more informative and complex animation that allows to visualize monthly erythemal irradiance through the years as well as annual trends.</p>
<p><br/></p>
<pre class="r"><code>ani.options(ani.height = 720, ani.width = 720)
saveGIF({
    for(i in 1:nrow(labels)) {
        #layout
            mat &lt;- matrix(c(13:15,1:3,16:18,4:6,19:21,7:9,22:24,10:12), ncol = 3, nrow = 8, byrow = T) %&gt;%
                    cbind(c(0,0,25,25,25,25,0,0)) %&gt;%
                    rbind(26, .)
            layout(mat, widths = c(3,3,3,1.25), heights = c(1,rep(c(2,3),4)))

        # Rasters
            for(j in 1:ncol(labels)) {
                par(pch = 21,  xaxs = &quot;i&quot;, yaxs = &quot;i&quot;, family = &quot;serif&quot;, mar = c(0,0,0,0))
                r &lt;- raster::raster(UV[[1]][,,labels[i,j]], xmn = ext[1], xmx = ext[2], ymn = ext[3], ymx = ext[4], crs = spatProj) %&gt;%
                     mask(ocean)
                eplot(xmin = ext[1], xmax = ext[2], ymin = ext[3], ymax = ext[4])
                image(r, col= rbPal(100), breaks = seq(0,max_,length.out=101), legend = F, add = T)
                plot(ocean, add = T)
                text(x = -54.5, y = 45, labels = paste(colnames(labels)[j], rownames(labels)[i]), adj = 1, cex = 1.5)
            }

        # Plot trends
            for(j in 1:ncol(labels)) {
                temporal &lt;- data.frame(years = years[1:i], monthMean = monthMean[labels[1:i,j]], lowCI = lowCI[labels[1:i,j]], upCI = upCI[labels[1:i,j]]) %&gt;%
                            na.omit()
                polyY &lt;- c(temporal$upCI, rev(temporal$lowCI)) # Y coordinates for confidence interval polygon
                polyX &lt;- c(temporal$years, rev(temporal$years)) # X coordinates for confidence interval polygon   

                par(mar = c(0,3,1,1), family = &quot;serif&quot;)
                eplot(xmin = 2005, xmax = 2016, ymin = 0, ymax = max(upCI))
                polygon(polyX, polyY, border = &#39;transparent&#39;, col = &quot;#d9e5f4&quot;)
                lines(temporal$monthMean ~ temporal$years, lwd = 0.5, col = &#39;#0057bb&#39;)
                axis(side = 2, at = seq(0, plyr::round_any(max(upCI), 1000, ceiling), by = 2500), las = 1, pos = 2004.75, cex =  1.5)
            }

        # Plot legend
            colorBar(rbPal(101), min = 0, max = max_)

        # Graph title
            par(mar = c(0,0,0,0))
            eplot(xmin = 0, xmax = 10, ymin = 0, ymax = 10)
            text(x = 5, y = 5, labels = bquote(&quot;Erythemal UV Irradiance (mW/m&quot; ^2 *&quot;)&quot;), cex = 2)

    }
}, movie.name = &quot;UVanimate.gif&quot;)</code></pre>
<p><br/></p>
<div class="figure">
<img src="assets/img/UVanimate.gif" style="width:100.0%" />

</div>
<p><br/></p>
</div>
<div id="concluding-remarks" class="section level2">
<h2>Concluding remarks</h2>
<p>As you can see, it is quite straightforward to create powerful and informative animations in R.</p>
</div>

<br/><br/>

<div class="footer">
  Copyright &copy; 2017 LetiR. All rights reserved.   Made with <i class="ion-heart"></i>
    with <a href="http://rmarkdown.rstudio.com/rmarkdown_websites.html">
    Rmarkdown</a>. <br/>
  Content on this site is licensed under
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
      <i class='cc cc-cc-circle cc-1x'></i> <i class='cc cc-by-circle cc-1x'></i>
      <i class='cc cc-nc-circle cc-1x'></i> <i class='cc cc-sa-circle cc-1x'></i>
  </a> unless otherwise specified. <br/>
  Last update: 16-07-2017. Code source available on
    <a href="https://github.com/letiR/letiR_website">
      <i class='fa fa-github fa-1x'></i></a>
</div>

<!-- jQuery -->
<script>
  jQuery("h1.title").append("<hr class='hline_color'/>");
  jQuery("h1.title").before("<br/>");
  jQuery(".section.level2").before("<br/><br/>");
</script>



<!-- twitter -->
<script>
window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>


<!-- GoogleAnalytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-97559589-1', 'auto');
  ga('send', 'pageview');
</script>
<br/><br/><br/><br/><br/><br/>
<!-- disqus -->
 <div id="disqus_thread" class="standardPadding"></div>
    <script type="text/javascript">
      $(document).ready(function() {
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'LetiR'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            // create disqus script tag
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            // determine container
            var container = document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0];
            // append script tag enclosed by google indexing suppression comment
            container.appendChild(document.createComment('googleoff: all'));
            container.appendChild(dsq);
            container.appendChild(document.createComment('googleon: all'));
        })();
      });
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
