---
title: "Non linear regression with nls()"
author: [kevin]
date: 2018-11-18
tags: [R, regression, nls]
rpkgs: [stats]
draft: false
estime: 5
tweet: "Non linear regression with nls(), an example."
output:
  rmarkdown::html_page:
    toc: true
    fig_width: 3
    dev: svg
---



<div id="context" class="section level2">
<h2>Context</h2>
<p>Last week, I was discussing about how to use <code>nls()</code> for a specific
model with one of my colleague and I ended creating a piece of code to
show what I was talking about! Even though there are many posts exploring <code>nls()</code>
in more depth that I did (for instance <a href="https://datascienceplus.com/first-steps-with-non-linear-regression-in-r/">this post on datascienceplus by Lionel Herzog</a>),
I thought I could share these lines of command here!</p>
<p>Basically, we were talking about a model where the temperature (<span class="math inline">\(T\)</span>) follows
a saturation curve starting from 10°C at t=0 (so T(0) = 10) and plateauing at <span class="math inline">\(T_{\inf}\)</span>.</p>
<p><span class="math display">\[T(t) = T_{\inf} - (T_{\inf} - T_0)\exp(-kt)\]</span></p>
</div>
<div id="goal-and-data" class="section level2">
<h2>Goal and data</h2>
<p>The goal here is to use <code>nls()</code> (Nonlinear Least Squares) to find <span class="math inline">\(k\)</span> and <span class="math inline">\(T_{inf}\)</span>.
For the sack of clarity, I simulate the data, i.e. I use the saturation curve
with known parameter values, then I add some noise (here a <a href="https://en.wikipedia.org/wiki/White_noise">white noise</a>):</p>
<pre class="r"><code>library(magrittr)
# Parameters
## known
T0 = 10
## the ones we are looking for
k = 0.2
Tinf = 20

# Simulate data
## time
seqt &lt;- seq(0, 50, .25)
## create a data frame
simdata &lt;- cbind(
  seqt = seqt,
  sim = Tinf - (Tinf- T0) * exp(-k * seqt) + .5 * rnorm(length(seqt))
) %&gt;% as.data.frame
head(simdata)
#R&gt;    seqt      sim
#R&gt;  1 0.00 10.38974
#R&gt;  2 0.25 10.01724
#R&gt;  3 0.50 10.60535
#R&gt;  4 0.75 12.01071
#R&gt;  5 1.00 11.75615
#R&gt;  6 1.25 13.25908</code></pre>
</div>
<div id="use-nls" class="section level2">
<h2>Use <code>nls()</code></h2>
<p>Now I call <code>nls()</code> to fit the data:</p>
<pre class="r"><code>res &lt;- nls(sim ~ Tinf - (Tinf - 10)*exp(-k*seqt), simdata, list(Tinf = 1, k = .1))</code></pre>
<p>All the information needed are stored in <code>res</code> and display via the print method:</p>
<pre class="r"><code>res
#R&gt;  Nonlinear regression model
#R&gt;    model: sim ~ Tinf - (Tinf - 10) * exp(-k * seqt)
#R&gt;     data: simdata
#R&gt;     Tinf       k 
#R&gt;  19.9507  0.1996 
#R&gt;   residual sum-of-squares: 53.43
#R&gt;  
#R&gt;  Number of iterations to convergence: 7 
#R&gt;  Achieved convergence tolerance: 5.204e-06</code></pre>
<p>Let’s draw a quick plot:</p>
<pre class="r"><code>## get the coefficients values
cr &lt;- coef(res)
fitC &lt;- function(x) cr[1] - (cr[1] - 10)*exp(-cr[2]*x)
plot(simdata[,1], simdata[,2], xlab = &quot;Time (min)&quot;, ylab = &quot;Temperature (°C)&quot;)
curve(fitC, 0, 50, add = TRUE, col = &quot;#2f85a4&quot;, lwd = 3)</code></pre>
<p><img src="/post/2018/nlsex1_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="thats-all-folks" class="section level4">
<h4>That’s all folks!</h4>
<div style="padding: 2rem 0rem 2rem 0rem;">
<details>
<summary>
<h4>
<i class="fa fa-chevron-right" aria-hidden="true"></i>Session info
<i class="fa fa-cogs" aria-hidden="true"></i>
</h4>
<p></summary></p>
<pre class="r"><code>sessionInfo()
#R&gt;  R version 4.2.0 (2022-04-22)
#R&gt;  Platform: x86_64-pc-linux-gnu (64-bit)
#R&gt;  Running under: Debian GNU/Linux bookworm/sid
#R&gt;  
#R&gt;  Matrix products: default
#R&gt;  BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.1
#R&gt;  LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.1
#R&gt;  
#R&gt;  locale:
#R&gt;   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
#R&gt;   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
#R&gt;   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
#R&gt;   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
#R&gt;   [9] LC_ADDRESS=C               LC_TELEPHONE=C            
#R&gt;  [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
#R&gt;  
#R&gt;  attached base packages:
#R&gt;  [1] stats     graphics  grDevices utils     datasets  methods   base     
#R&gt;  
#R&gt;  other attached packages:
#R&gt;  [1] magrittr_2.0.3         inSilecoRef_0.0.1.9000
#R&gt;  
#R&gt;  loaded via a namespace (and not attached):
#R&gt;   [1] Rcpp_1.0.8.3      lubridate_1.8.0   ps_1.7.0          assertthat_0.2.1 
#R&gt;   [5] digest_0.6.29     utf8_1.2.2        mime_0.12         R6_2.5.1         
#R&gt;   [9] plyr_1.8.7        backports_1.4.1   evaluate_0.15     httr_1.4.3       
#R&gt;  [13] highr_0.9         blogdown_1.10     pillar_1.7.0      rlang_1.0.2      
#R&gt;  [17] curl_4.3.2        data.table_1.14.2 miniUI_0.1.1.1    callr_3.7.0      
#R&gt;  [21] jquerylib_0.1.4   DT_0.23           rmarkdown_2.14    RefManageR_1.3.0 
#R&gt;  [25] rcrossref_1.1.0   stringr_1.4.0     htmlwidgets_1.5.4 igraph_1.2.11    
#R&gt;  [29] shiny_1.7.1       compiler_4.2.0    httpuv_1.6.5      xfun_0.31        
#R&gt;  [33] pkgconfig_2.0.3   htmltools_0.5.2   tidyselect_1.1.2  tibble_3.1.7     
#R&gt;  [37] httpcode_0.3.0    bookdown_0.26     codetools_0.2-18  fansi_1.0.3      
#R&gt;  [41] crayon_1.5.1      dplyr_1.0.9       withr_2.5.0       later_1.3.0      
#R&gt;  [45] crul_1.2.0        jsonlite_1.8.0    xtable_1.8-4      lifecycle_1.0.1  
#R&gt;  [49] DBI_1.1.2         cli_3.3.0         stringi_1.7.6     promises_1.2.0.1 
#R&gt;  [53] xml2_1.3.3        bslib_0.3.1       ellipsis_0.3.2    targets_0.12.0   
#R&gt;  [57] generics_0.1.2    vctrs_0.4.1       tools_4.2.0       glue_1.6.2       
#R&gt;  [61] purrr_0.3.4       processx_3.5.3    fastmap_1.1.0     yaml_2.3.5       
#R&gt;  [65] base64url_1.4     knitr_1.39        sass_0.4.1</code></pre>
</details>
</div>
</div>
</div>
