---
title: R in Space - Spatial Objects in R
author: [david, marieh, nicolas, kevin, elliot, steve]
date: 2018-04-03
tags: [R in Space, R, Spatial]
rpkgs: [sp, sf, raster]
draft: true
tweet: "R in Space - Spatial Objects in R"
estime: 10
navposts:
  prev: rinspace_spobjinr
  home: rinspace_homepage
  next: rinspace_import
output:
  rmarkdown::html_page:
    fig_width: 3
    dev: svg
---



<p><img src="https://img.shields.io/badge/inSileco-InDevelopment-3fb3b2.svg" /></p>
<div id="vector-objects-in-r" class="section level2">
<h2>Vector objects in R</h2>
<p>In this section we present two packges: <code>sp</code> and <code>sf</code>. The <code>sp</code> package actualy
defines classes for both vector and raster objects. Below, we
however focus on the vector ones and so we do not detail <code>SpatialGrid</code> and
<code>SpatialPixels</code> objects. Also note that <code>sf</code> “[…] aims at succeeding <code>sp</code> in
the long term” (<a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">Simple Features for R</a>,
<code>sf</code> vignette).</p>
<p>Let first create a data frame <code>mydata</code>:</p>
<pre class="r"><code>mylon &lt;- -82+2*runif(20)
mylat &lt;- 42+2*runif(20)
mydata &lt;- data.frame(
  lon = mylon,
  lat = mylat,
  var1 = rnorm(20),
  var2 = 10*runif(20)
)</code></pre>
<p>Let’s have a look at thus data frame:</p>
<table>
<thead>
<tr class="header">
<th align="right">lon</th>
<th align="right">lat</th>
<th align="right">var1</th>
<th align="right">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-81.80247</td>
<td align="right">42.61008</td>
<td align="right">0.4903868</td>
<td align="right">1.075007</td>
</tr>
<tr class="even">
<td align="right">-80.38990</td>
<td align="right">42.02608</td>
<td align="right">-0.3728839</td>
<td align="right">4.172873</td>
</tr>
<tr class="odd">
<td align="right">-80.78485</td>
<td align="right">43.08422</td>
<td align="right">-0.2509555</td>
<td align="right">5.859953</td>
</tr>
<tr class="even">
<td align="right">-81.23434</td>
<td align="right">43.10306</td>
<td align="right">-0.7129443</td>
<td align="right">9.746547</td>
</tr>
<tr class="odd">
<td align="right">-80.00439</td>
<td align="right">42.99512</td>
<td align="right">1.0514086</td>
<td align="right">1.311865</td>
</tr>
<tr class="even">
<td align="right">-80.01515</td>
<td align="right">42.58484</td>
<td align="right">0.2805270</td>
<td align="right">6.302691</td>
</tr>
</tbody>
</table>
<div id="package-sp" class="section level3">
<h3>Package <code>sp</code></h3>
<div id="classes" class="section level4">
<h4>Classes</h4>
<p>The table below includes a description of the classes for points, lines and polygons.
Basically all these classes work the same way. For instance, in order to define a
<code>SpatialPointsDataPoints</code> object, three elements are required: a set of coordinates,
a Coordinate Reference System (CRS) and an attribute table. Intermediate
class are also defined (for instance points + CRS = <code>SpatialPoints</code>) and
the name of the class is also the name of the function to be called.</p>
<table>
<thead>
<tr class="header">
<th>Classes and functions</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Points</td>
<td>list of points (set of coordinates)</td>
</tr>
<tr class="even">
<td>SpatialPoints</td>
<td>list of points + CRS</td>
</tr>
<tr class="odd">
<td>SpatialPointsDataPoints</td>
<td>list of points + CRS + attribute table</td>
</tr>
<tr class="even">
<td>Line</td>
<td>a line (set of coordinates)</td>
</tr>
<tr class="odd">
<td>Lines</td>
<td>list of lines</td>
</tr>
<tr class="even">
<td>SpatialLines</td>
<td>list of lines + CRS</td>
</tr>
<tr class="odd">
<td>SpatialLinesDataFrame</td>
<td>list of lines + CRS + attribute table</td>
</tr>
<tr class="even">
<td>Polygon</td>
<td>a line (set of coordinates)</td>
</tr>
<tr class="odd">
<td>Polygons</td>
<td>list of lines</td>
</tr>
<tr class="even">
<td>SpatialPolygons</td>
<td>list of lines + CRS</td>
</tr>
<tr class="odd">
<td>SpatialPolygonsDataFrame</td>
<td>list of lines + CRS + attribute table</td>
</tr>
</tbody>
</table>
</div>
<div id="spatialpointsdataframe" class="section level4">
<h4><code>SpatialPointsDataFrame</code></h4>
<p>As an more tangible example, let’s now create a <code>SpatialPointsDataFrame</code>
based on our data frame <code>mydata</code>.</p>
<pre class="r"><code>library(sp)
mysp &lt;- SpatialPointsDataFrame(
  coords = mydata[, 1:2],
  data = mydata[, 3:4],
  proj4string = CRS(
    &quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0&quot;
  )
)</code></pre>
<p>Note that <a href="https://github.com/OSGeo/proj.4">proj4</a> is used and we therefore
wrote a string that describes the CRS and that proj4 understands. Below are
listed some properties of the object we have defined.</p>
<pre class="r"><code>isS4(mysp)
class(mysp)
slotNames(mysp)
dim(mysp)</code></pre>
<pre><code>## [1] TRUE
## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;
## [1] &quot;data&quot;        &quot;coords.nrs&quot;  &quot;coords&quot;      &quot;bbox&quot;        &quot;proj4string&quot;
## [1] 20  2</code></pre>
<p>Basically, it is a <a href="http://adv-r.had.co.nz/S4.html">S4 object</a> of class
<code>SpatialPointsDataFrame</code>. All slot names refer to attribute that are accessible
<em>via</em> and <code>@</code>:</p>
<pre class="r"><code>mysp@proj4string</code></pre>
<pre><code>## CRS arguments:
##  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0</code></pre>
<pre class="r"><code>head(mysp@data)</code></pre>
<pre><code>##         var1     var2
## 1  0.4903868 1.075007
## 2 -0.3728839 4.172873
## 3 -0.2509555 5.859953
## 4 -0.7129443 9.746547
## 5  1.0514086 1.311865
## 6  0.2805270 6.302691</code></pre>
<p>In order to change projection, the user must call <code>spTransform()</code>, like so:</p>
<pre class="r"><code>(mysp2 &lt;- spTransform(mysp, CRS=CRS(&quot;+proj=merc +ellps=GRS80&quot;)))</code></pre>
<pre><code>##            coordinates       var1      var2
## 1  (-9106209, 5223873)  0.4903868 1.0750068
## 2  (-8948963, 5136273) -0.3728839 4.1728729
## 3  (-8992929, 5295604) -0.2509555 5.8599533
## 4  (-9042965, 5298466) -0.7129443 9.7465468
## 5  (-8906048, 5282081)  1.0514086 1.3118647
## 6  (-8907245, 5220070)  0.2805270 6.3026912
## 7  (-9042948, 5145204) -0.1555556 9.2233957
## 8  (-9076383, 5196514) -1.5763767 3.2794677
## 9  (-8995392, 5335434) -0.9360012 6.2511890
## 10 (-9051238, 5313169) -1.9618193 9.6358048
## 11 (-8993305, 5348739)  0.6875291 9.6784056
## 12 (-8962618, 5191968) -2.5792279 6.3402616
## 13 (-8968264, 5265367)  0.5132591 0.9199481
## 14 (-9088538, 5263445) -0.1029454 9.8287148
## 15 (-9062079, 5253576)  2.9264774 2.7262909
## 16 (-9024141, 5230893) -1.3888945 5.4826402
## 17 (-9097535, 5240177)  0.3080607 6.9272324
## 18 (-8982077, 5370244) -0.7809782 7.5838168
## 19 (-8946075, 5216955) -0.7165933 7.9745811
## 20 (-9043602, 5419564) -0.1517392 7.4660745</code></pre>
</div>
</div>
<div id="package-sf" class="section level3">
<h3>Package <code>sf</code></h3>
<p>Below is a very short overview of classes in <code>sf</code>, the reader that requires
further explanation would find more details on the
<a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#sf-objects-with-simple-features">first vignette of sf</a>.
Basically three classes are defined: <code>sf</code>, <code>sfc</code> and <code>sfg</code>.</p>
<div id="class-sf" class="section level4">
<h4>Class <code>sf</code></h4>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.6.2, GDAL 2.2.4, proj.4 5.0.0</code></pre>
<pre class="r"><code>pts_sf &lt;- st_as_sf(
  x = mydata,
  coords = c(&quot;lon&quot;, &quot;lat&quot;),
  crs = 4326)</code></pre>
<p>Let’s examine its class</p>
<pre class="r"><code>class(pts_sf)</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
</div>
<div id="class-sfc" class="section level4">
<h4>Class <code>sfc</code></h4>
<pre class="r"><code>pts_sfc &lt;- st_geometry(pts_sf)
class(pts_sfc)</code></pre>
<pre><code>## [1] &quot;sfc_POINT&quot; &quot;sfc&quot;</code></pre>
</div>
<div id="class-sfg" class="section level4">
<h4>Class <code>sfg</code></h4>
<pre class="r"><code>(x &lt;- st_point(c(1,2)))</code></pre>
<pre><code>## POINT (1 2)</code></pre>
<pre class="r"><code>class(x)</code></pre>
<pre><code>## [1] &quot;XY&quot;    &quot;POINT&quot; &quot;sfg&quot;</code></pre>
</div>
<div id="how-to-import-a-sp-object" class="section level4">
<h4>How to import a <code>sp</code> object</h4>
<p><code>st_as_sf()</code> can also be used to convert a <code>sp</code> object into a <code>sf</code> one.</p>
<pre class="r"><code>st_as_sf(mysp)</code></pre>
<pre><code>## Simple feature collection with 20 features and 2 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -81.80247 ymin: 42.02608 xmax: -80.00439 ymax: 43.89495
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## First 10 features:
##          var1     var2                   geometry
## 1   0.4903868 1.075007 POINT (-81.80247 42.61008)
## 2  -0.3728839 4.172873  POINT (-80.3899 42.02608)
## 3  -0.2509555 5.859953 POINT (-80.78485 43.08422)
## 4  -0.7129443 9.746547 POINT (-81.23434 43.10306)
## 5   1.0514086 1.311865 POINT (-80.00439 42.99512)
## 6   0.2805270 6.302691 POINT (-80.01515 42.58484)
## 7  -0.1555556 9.223396 POINT (-81.23418 42.08587)
## 8  -1.5763767 3.279468 POINT (-81.53454 42.42827)
## 9  -0.9360012 6.251189 POINT (-80.80698 43.34591)
## 10 -1.9618193 9.635805 POINT (-81.30866 43.19977)</code></pre>
</div>
</div>
</div>
<div id="raster-objects-in-r" class="section level2">
<h2>Raster objects in R</h2>
<p>Package <code>raster</code> define three classes of rater object we detail below.</p>
<div id="rasterlayer" class="section level3">
<h3>RasterLayer</h3>
<p><a href="http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterlayer" class="uri">http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterlayer</a></p>
<pre class="r"><code>library(raster)
val1 &lt;- matrix(runif(100*100,0,10), ncol = 100, nrow = 100)
ras1 &lt;- raster(
    val1,
    crs = CRS(&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;),
    xmn = -82, xmx = +80, ymn = +42, ymx = +44
  )
class(ras1)</code></pre>
<pre><code>## [1] &quot;RasterLayer&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
</div>
<div id="rasterstack-and-rasterbrick" class="section level3">
<h3>RasterStack and RasterBrick</h3>
<p><a href="http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterstack-and-rasterbrick" class="uri">http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterstack-and-rasterbrick</a></p>
<p>Let’s first create another raster (with the same CRS)</p>
<pre class="r"><code>val2 &lt;- matrix(rnorm(100*100), ncol = 100, nrow = 100)
ras2 &lt;- raster(
    val2,
    crs = CRS(&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;),
    xmn = -82, xmx = +80, ymn = +42, ymx = +44
  )
class(ras2)</code></pre>
<pre><code>## [1] &quot;RasterLayer&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<p>Let’s <code>stack()</code> <code>ras1</code> and <code>ras2</code>:</p>
<pre class="r"><code>sta1 &lt;- stack(ras1, ras2)
class(sta1)</code></pre>
<pre><code>## [1] &quot;RasterStack&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<p>Let’s <code>brick()</code> them:</p>
<pre class="r"><code>bri1 &lt;- brick(ras1, ras2)
class(bri1)</code></pre>
<pre><code>## [1] &quot;RasterBrick&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
</div>
</div>
