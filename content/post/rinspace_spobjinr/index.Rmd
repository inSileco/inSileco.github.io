---
title: R in Space - Spatial Objects in R
author: [david, marieh, nicolas, kevin, elliot, steve]
date: 2018-04-03
tags: [R in Space, R, Spatial]
rpkgs: [sp, sf, raster]
draft: true
tweet: "R in Space - Spatial Objects in R"
estime: 10
navposts:
  prev: rinspace_spobjinr
  home: rinspace_homepage
  next: rinspace_import
output:
  rmarkdown::html_page:
    fig_width: 3
    dev: svg
---

![](https://img.shields.io/badge/inSileco-InDevelopment-3fb3b2.svg)


## Vector object in R

In this section we present two packges: `sp` and `sf`. The `sp` package actualy
defines classes for both vector and raster objects. Below, we
however focus on the vector ones and so we do not detail `SpatialGrid` and
`SpatialPixels` objects. Also note that `sf` "[...] aims at succeeding `sp` in
the long term" ([Simple Features for R](https://cran.r-project.org/web/packages/sf/vignettes/sf1.html),
`sf` vignette).

Let first create a data frame `mydata`:

```{r sim_points, results='asis'}
mylon <- -82+2*runif(20)
mylat <- 42+2*runif(20)
mydata <- data.frame(
  lon = mylon,
  lat = mylat,
  var1 = rnorm(20),
  var2 = 10*runif(20)
)
```

Let's have a look at thus data frame:

```{r show_points, results='asis', echo=F}
knitr::kable(head(mydata))
```






### Package `sp`

#### Classes

The table below includes a description of the classes for points, lines and polygons.
Basically all these classes work the same way. For instance, in order to define a
`SpatialPointsDataPoints` object, three elements are required: a set of coordinates,
a Coordinate Reference System (CRS) and an attribute table. Intermediate
class are also defined (for instance points + CRS = `SpatialPoints`) and
the name of the class is also the name of the function to be called.

Classes and functions       | Contents
--------------------------- | ---------------
Points                      | list of points (set of coordinates)
SpatialPoints               | list of points + CRS
SpatialPointsDataPoints     | list of points + CRS + attribute table
Line                        | a line (set of coordinates)
Lines                       | list of lines
SpatialLines                | list of lines + CRS
SpatialLinesDataFrame       | list of lines + CRS + attribute table
Polygon                     | a line (set of coordinates)
Polygons                    | list of lines
SpatialPolygons             | list of lines + CRS
SpatialPolygonsDataFrame    | list of lines + CRS + attribute table



#### `SpatialPointsDataFrame`

As an more tangible example, let's now create a `SpatialPointsDataFrame`
based on our data frame `mydata`.

```{r sppoint, message = F}
library(sp)
mysp <- SpatialPointsDataFrame(
  coords = mydata[, 1:2],
  data = mydata[, 3:4],
  proj4string = CRS(
    "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"
  )
)
```

Note that [proj4](https://github.com/OSGeo/proj.4) is used and we therefore
wrote a string that describes the CRS and that proj4 understands. Below are
listed some properties of the object we have defined.



```{r sppoint2, results="hold"}
isS4(mysp)
class(mysp)
slotNames(mysp)
```

Basically, it is a [S4 object](http://adv-r.had.co.nz/S4.html) of class
`SpatialPointsDataFrame`. All slot names refer to attribute that are accessible
*via* and `@`:


```{r sppoint3}
mysp@proj4string
head(mysp@data)
```

In order to change projection, the user must call `spTransform()`, like so:

```{r spTransform}
(mysp2 <- spTransform(mysp, CRS=CRS("+proj=merc +ellps=GRS80")))
```


### Package `sf`

Below is a very short overview of classes in `sf`, the reader that requires
further explanation would find more details on the
[first vignette of sf](https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#sf-objects-with-simple-features).
Basically three classes are defined: `sf`, `sfc` and `sfg`.


#### Class `sf`

```{r sf1_a}
library(sf)
pts_sf <- st_as_sf(
  x = mydata,
  coords = c("lon", "lat"),
  crs = 4326)
```

Let's examine its class

```{r sf1_b}
class(pts_sf)
```

#### Class `sfc`

```{r sf2}
pts_sfc <- st_geometry(pts_sf)
class(pts_sfc)
```


#### Class `sfg`

```{r sf3}
(x <- st_point(c(1,2)))
class(x)
```

#### How to import a `sp` object

`st_as_sf()` can also be used to convert a `sp` object into a `sf` one.

```{r sf4}
st_as_sf(mysp)
```


## Raster objects

Package `raster` define three classes of rater object we detail below.


### RasterLayer

http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterlayer

```{r raster, message = F}
library(raster)
val1 <- matrix(runif(100*100,0,10), ncol = 100, nrow = 100)
ras1 <- raster(
    val1,
    crs = CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"),
    xmn = -82, xmx = +80, ymn = +42, ymx = +44
  )
class(ras1)
```



### RasterStack and RasterBrick

http://www.rspatial.org/spatial/rst/4-rasterdata.html#rasterstack-and-rasterbrick

Let's first create another raster (with the same CRS)

```{r raster3}
val2 <- matrix(rnorm(100*100), ncol = 100, nrow = 100)
ras2 <- raster(
    val2,
    crs = CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"),
    xmn = -82, xmx = +80, ymn = +42, ymx = +44
  )
class(ras2)
```

Let's `stack()` `ras1` and `ras2`:

```{r raster4}
sta1 <- stack(ras1, ras2)
class(sta1)
```

Let's `brick()` them:

```{r raster5}
bri1 <- brick(ras1, ras2)
class(bri1)
```
