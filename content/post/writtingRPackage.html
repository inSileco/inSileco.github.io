---
title: "rcites, behind the scenes"
author: [kevin]
date: 2018-09-20
tags: [R, package, development]
rpkgs: [devtools]
draft: true
tweet: "First R package to the CRAN"
estime: 12
output:
  rmarkdown::html_page:
    toc: true
    fig_width: 3
    dev: svg
---



<p>With a couple of colleagues, we have recently released a R package to the CRAN, <a href="https://github.com/ibartomeus/rcites">rcites</a> a R client for the <a href="https://api.speciesplus.net/">Species+ API</a>. In the lines below, I would like to share
my experience, few thoughts about R packages as well as valuables resources.</p>
<p><a href="http://web.mit.edu/insong/www/pdf/rpackage_instructions.pdf" class="uri">http://web.mit.edu/insong/www/pdf/rpackage_instructions.pdf</a></p>
<p><a href="https://github.com/r-lib/pkgbuild" class="uri">https://github.com/r-lib/pkgbuild</a></p>
<div id="what-is-a-r-package" class="section level2">
<h2>What is a R package?</h2>
<p>In the introduction of his book <a href="http://r-pkgs.had.co.nz/intro.html">R packages</a>, Hadley Wickham wrote:</p>
<blockquote>
<p>A package bundles together code, data, documentation, and tests, and is easy to share with others.</p>
</blockquote>
<p>I like the way he presents a package, it is straightforward and crystal clear.
Interestingly enough, it describes what a package <strong>does</strong>, not what a
package <strong>is</strong>. Defining R package is actually harder than I thought! I remember the first time I’ve tried to characterize a R packages, I ask a couple of questions and find the answer quite surprising:</p>
<ul>
<li>Are R packages extensions available on <a href="https://cran.r-project.org/">CRAN</a> or <a href="https://www.bioconductor.org/">Bioconductor</a>? <strong>Not necessarly!</strong></li>
</ul>
<p>The answer sounds obvious nowadays with almost <a href="https://rdrr.io/">40K R packages on Github</a>, but 10 years I guess it wasn’t. However it is important to notice that an R package that only exists (yet) in your own computer is an R packages.</p>
<ul>
<li>Should a package have a minimum number of functions? <strong>No</strong></li>
</ul>
<p>Even among the most popular packages, the number of package is not a criterion.
<a href="https://cran.r-project.org/web/packages/vegan/index.html">vegan</a> exports 192 functions (as of version 2.5.2) while <a href="https://cran.r-project.org/web/packages/png/">png</a> only includes
two functions.</p>
<ul>
<li>Should a package be designed to perform a specific analysis? <strong>No</strong></li>
</ul>
<p>Two points here. First R packages can be designed to do many things: they can turn R into a power Geographic Information System or make you R session
crash each time you load it (see <a href="https://github.com/romainfrancois/trump">trump</a>)!</p>
<p>So <strong>what is a R package?</strong> Well my own definition would be:</p>
<blockquote>
<p>a set of files that passes the command <code>R CMD INSTALL</code></p>
</blockquote>
<p>From that definition, one should understand that a R package does not necessarily perform any analysis correctly. It is not what it is and on the CRAN, nobody check if your package do it right, they however check if it is pass this command line
(note that I can tell you now that people who review your package also give you valuable advice!).</p>
</div>
<div id="why-create-a-r-package" class="section level2">
<h2>Why create a R package?</h2>
<p>This is another crucial question. In <a href="http://r-pkgs.had.co.nz/intro.html">his introduction</a> Hadley Wickham emphazised that R packages are a standard way to organize your project which helps you saving time and ease the code sharing. Once your are used to R packaes I guearentee you always organize your folder the same way and you dont loose your time finding a specific file.</p>
<p>I guess for an academic using R to implement a nethid he develops the answer shold be
yes be in general the answer os no. Second an R package is not defined by the
methods it implemnts and there are no quality required to define.</p>
<p>Creating R packages is</p>
</div>
<div id="why-share-your-r-package" class="section level2">
<h2>Why share your R package?</h2>
<p>Sharing with collaborator</p>
<p>Reporducible science</p>
<p>Helps us, people helps here we hope that package and further devc</p>
<p>I had previous experience in creating package actually I have a couple
of R packages that are on GH, and so far, I think that’s where they should
be:</p>
<ul>
<li><p><a href="https://github.com/inSileco/inSilecoMisc">inSilecoMisc</a></p></li>
<li><p><a href="https://github.com/KevCaz/burningHouse">burningHouse</a></p></li>
</ul>
<p><a href="https://www.frontiersin.org/articles/10.3389/fevo.2017.00175/full" class="uri">https://www.frontiersin.org/articles/10.3389/fevo.2017.00175/full</a></p>
<p>In fact
CRAN does not reflcte quality of R package which leads sone people to coplain
and <a href="http://www.stat.tugraz.at/AJS/ausg121/121Hornik.pdf">Kurt Hortnik, CRAN maintainer to discuss whether number of packages</a></p>
<blockquote>
<p>In fact, packages can be employed as “containers” for
all kinds of R extension material, such as data sets or documentation (manuals or books):
because packages are versioned, keeping the extensions up-to-date can easily be achieved.</p>
</blockquote>
<p>I think it is however not a definition and I think when we think about</p>
<blockquote>
<p>Package authors often seem to prefer copying code from other packages than
depending on these, or collaborate to develop a common infrastructure. If packages pro-
vide different solutions to similar tasks, they will evidently rather compete than cooperate
through hierarchical dependencies.</p>
</blockquote>
<p>what a R package really is, it becomes quite interesting.</p>
<p>package, we my guess is that we have to narrow down to a technical
definition like: a set of structured files that pass the <code>R CMD check</code>.</p>
<p>answer, it is</p>
<p>This is not a question easy to answer. The easy way to answer is thI guess</p>
<p><a href="http://r-pkgs.had.co.nz/intro.html" class="uri">http://r-pkgs.had.co.nz/intro.html</a></p>
<p>About the number of package
<a href="https://cran.r-project.org/web/packages/" class="uri">https://cran.r-project.org/web/packages/</a></p>
<p><a href="https://gist.github.com/daroczig/3cf06d6db4be2bbe3368" class="uri">https://gist.github.com/daroczig/3cf06d6db4be2bbe3368</a></p>
<p><a href="http://blog.revolutionanalytics.com/2017/01/cran-10000.html" class="uri">http://blog.revolutionanalytics.com/2017/01/cran-10000.html</a></p>
<p><a href="https://www.r-pkg.org/" class="uri">https://www.r-pkg.org/</a></p>
<p><a href="https://awesome-r.com/" class="uri">https://awesome-r.com/</a></p>
</div>
<div id="how-to-proceed" class="section level2">
<h2>How to proceed?</h2>
<p>Below I give a very brief description of how we proceeded for <a href="">rcites</a> and
try to gather useful resources. Before starting writing a to have a look at
resource that dealt in depth with this topic. I remember that I strated
by writing <a href="http://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/">“Writing an R package from scratch” by Hilary Parker</a>
that helps pied a l’étrier to start with and then read <a href="http://r-pkgs.had.co.nz/">Rpackages by Hadley Wickham</a>,exhaustive and very pedagogical. Last but nor least remeber that all technical details [exhaustive documentation](<a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html</a>
After 3 years of experience and a couple of packages I do not frequenlty have
to look at then anymore, they however always my answer if the question was not
ask on stack before!</p>
<div id="local-development" class="section level3">
<h3>Local development</h3>
<p>I personally use the <a href=""></a> packages developed by Wicham and colleague that
make you life really easy with packae. and basically explianed with the
book.</p>
</div>
<div id="the-devtools-packages" class="section level3">
<h3>The <em>devtools</em> packages</h3>
<p>This is the R package you need to develop your own R package efficiently.
Hadley Wickham and colleagues have cleverly automated many steps for creating R packages in different packages that are used by <em>devtools</em>.
Let’s say you have a bunch of R functions. What you need to do is to make a folder called <strong>yourRpackage</strong> where you edit a file <strong>DESCRIPTION</strong> that <a href="http://r-pkgs.had.co.nz/description.html">describes your package</a>.
Then, you must create a subfolder named <strong>R</strong> where you put your R functions (usually with a filename extension “<em>.R</em>” ) and then put all your R functions within.
Before going any further, you must document your functions.
To do so at the head of all you function, you must use a couple of lines starting by <strong>#’</strong> that will be used by <em>devtools</em> (via <em>roxygen2</em>) to produce the documentation. The basic syntax is:</p>
<pre><code>#&#39; @nameofsection  (e.g. @return, @examples, ...)
#&#39; what you need to write</code></pre>
<p>To have more details, the minimal example from <a href="http://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/">Hilary Parker</a> is well-chosen. To go deeper, look at <a href="http://r-pkgs.had.co.nz/man.html">what Hadley Wickham wrote</a>. Once your function os documented, you simply need to use 2 functions, like so:</p>
<pre><code>load_all(&quot;path2yourRpackage&quot;)
document(&quot;path2yourRpackage&quot;)</code></pre>
<p>The first function will load all the functions in the <strong>R</strong> folder, the second will create the folder <strong>man</strong> that contains one document file for each function based on what you wrote.
Those functions check wether your package is in accordance with the architecture of an R package. However neither your code nor your examples are tested.
Therefore, you must strongly benefit from <a href="http://r-pkgs.had.co.nz/check.html">testing your package</a>.
One first thing to do is to use the function <em>check</em> of ‘devtools’ package.
Also, thanks to the <a href="https://cran.r-project.org/web/packages/testthat/index.html"><em>testthat</em></a> you have a simple unit testing system.
I do not take advantage from this package, I rather use Travis as explained below.</p>
</div>
<div id="github-travis-appveyor" class="section level3">
<h3>Github + Travis + Appveyor</h3>
<p><a href="https://github.com">Github</a> is becoming an inescapable tool for developers. Even without collaboration Github is an useful way to work efficiently.
It offers a place to save your work, see clearly your progress and share to everyone your achievements.
If your are not familiar with Github, you can have a look at the <a href="https://en.wikipedia.org/wiki/GitHub">wikipedia page</a>. Then, if you are eager to use it, I suggest you go through the <a href="https://en.wikipedia.org/wiki/GitHub">users documentation</a>.</p>
<p>For an R package, there is one important extra asset: people can download and install your package using functions <em>install_github</em> or <em>install_git</em> of <em>devtools</em>. Even for your-self this is useful: once you have pushed your package to Github, you can install the released version through this process while keeping the version under development apart. Then, anytime you improve your package, you can test and document the new functions, make a new commit and so on.</p>
<p>Even better, for each commit you push, a series of automated testing code can be made on a dedicated server. This is the magic of the continuous integration service <a href="https://travis-ci.org">Travis</a>. A couple of minute after pushing the new commit, you receive an email stating whether or not your package have been built with success.</p>
<p>To start with Travis, after signing up (with your github account), you only need to read 1) <a href="http://docs.travis-ci.com/user/for-beginners">the thin documentation for complete beginners</a> and 2) the details regarding the <a href="http://docs.travis-ci.com/user/languages/r/">R language</a>. Then you must decide whether or not using Travis for your projects.
You will likely notice that Travis for R language is community supported. Therefore, we are indebted to Craig Citro, Dirk Eddelbuettel, Hadley Wickham and people that contribute to the <a href="https://github.com/craigcitro/r-travis">r-travis project</a>, so thank you guys, it helps a lot!</p>
</div>
<div id="license-and-version-of-your-package" class="section level3">
<h3>License and Version of your package</h3>
<p>Two last points to conclude this post.</p>
<p>First, you may wonder what kind of license you must pick up for your package.
In this case, I recommend you to go and visit this website:
<a href="http://choosealicense.com">“ChooseALicense”</a>.</p>
<p>Also, to chose the version number of you R package, I recommend you to follow the recommendation of <a href="http://semver.org">Semantic Versioning</a>. This will make the three numbers you add to your package name meaningful while others make the <a href="https://en.wikipedia.org/wiki/TeX">version number converging to pi</a>.</p>
<p><br/></p>
</div>
<div id="submit-your-r-packages" class="section level3">
<h3>Submit your R packages</h3>
<div id="cran" class="section level4">
<h4>CRAN</h4>
</div>
<div id="ropenscience" class="section level4">
<h4>Ropenscience</h4>
</div>
<div id="joss" class="section level4">
<h4>JOSS</h4>
</div>
</div>
<div id="section" class="section level3">
<h3></h3>
<p>On CRAN JOSS Ropenscience for review (beyond the technical details).</p>
<p><a href="https://simplystatistics.org/2015/11/06/how-i-decide-when-to-trust-an-r-package/" class="uri">https://simplystatistics.org/2015/11/06/how-i-decide-when-to-trust-an-r-package/</a></p>
<p><a href="https://cran.r-project.org/web/packages/png/index.html" class="uri">https://cran.r-project.org/web/packages/png/index.html</a></p>
<p><a href="https://www.r-project.org/dsc/2017/slides/R-hub.pdf" class="uri">https://www.r-project.org/dsc/2017/slides/R-hub.pdf</a></p>
<p><a href="https://github.com/r-hub/rhub" class="uri">https://github.com/r-hub/rhub</a></p>
<p><a href="https://builder.r-hub.io/" class="uri">https://builder.r-hub.io/</a></p>
<p><a href="http://blog.revolutionanalytics.com/2016/10/r-hub-public-beta.html" class="uri">http://blog.revolutionanalytics.com/2016/10/r-hub-public-beta.html</a></p>
</div>
</div>
<div id="documentation-and-tools-to-build-r-packages" class="section level2">
<h2>Documentation and tools to build R packages</h2>
</div>
