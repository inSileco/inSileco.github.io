language: r
dist: bionic
branches:
  only:
  - dev
  - master

cache:
  packages: true
  directories:
  - "$HOME/bin"

addons:
  apt:
    update: true
    packages:
      - libudunits2-dev
      - libproj-dev
      - libgeos-dev
      - libgdal-dev
      - r-cran-ncdf4
      - r-cran-lwgeom
      - r-cran-sf
      - libfreetype6-dev
      - libpoppler-cpp-dev
      - libssl-dev
      - libmagick++-dev
  snaps:
      - hugo

before_script:
  - apt-cache policy libstdc++6
script:
  - Rscript -e 'blogdown::build_site()'
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GH_TOKEN"
  target_branch: master
  local_dir: public
  true:
    branch: dev

notifications:
  slack:
    rooms:
      secure: "$encrypted_key_slack"
    template:
    - "%{repository} (%{commit}) : %{message} %{foo} "
    - 'Build: %{build_url}'
    - 'website: https://insileco.github.io/'
    - 'duration: %{duration}'