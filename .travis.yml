language: r
dist: bionic
branches:
  only:
  - dev
  - master

cache:
  packages: true
  directories:
  - "$HOME/bin"

apt_packages:
- libgdal-dev
- libgeos-dev
- libgeos++-dev
- libproj-dev
- r-cran-ncdf4
- libudunits2-dev
- libfreetype6-dev
- libpoppler-cpp-dev
- libssl-dev
- libmagick++-dev

before_install:
- wget https://github.com/gohugoio/hugo/releases/download/v0.53/hugo_0.53_Linux-64bit.deb
- sudo dpkg -i hugo_0.53_Linux-64bit.deb
before_script:
- apt-cache policy libstdc++6
script:
- Rscript -e 'blogdown::build_site()'
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GH_TOKEN"
  target_branch: master
  local_dir: public
  true:
    branch: dev

notifications:
  slack:
    rooms:
      secure: $encrypted_key_slack
    template:
    - "%{repository} (%{commit}) : %{message} %{foo} "
    - 'Build: %{build_url}'
    - 'website: https://insileco.github.io/'
    - 'duration: %{duration}'